(window.webpackJsonp=window.webpackJsonp||[]).push([["9b69690c2f17eb6642dea9531af86fbd"],{"/TnQ":function(e,t,r){"use strict";var n=r("ANjH").compose;t.__esModule=!0,t.composeWithDevTools=function(){if(0!==arguments.length)return"object"==typeof arguments[0]?n:n.apply(null,arguments)},t.devToolsEnhancer=function(){return function(e){return e}}},"0fW4":function(e,t,r){"use strict";r.r(t);var n=r("q1tI"),o=r.n(n),a=r("/MKj"),i=r("ANjH"),s=r("dImZ"),c=r.n(s),l=r("/TnQ"),u=r("sINF"),p=r("xYVc"),d=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n};function f(e){var t=e.present.background,r=t.currentBackgroundType,n=t.currentPhotoUrl,o=t.currentBackgroundId,a="";if(r===p.default.BACKGROUND_MODES.PHOTO)a=n||"";else{var i=e.present.data.backgrounds,s=i.gradients,c=i.emojies;a=d(s,c).filter((function(e){return e.id===o}))[0].url}return a}function _(e){var t=e.present.data,r=t.addons,n=t.artboardHeight,o=n;return r&&r.photoHeight&&(o=r.photoHeight),n/2-o/2}var h,g="SET_SETTING_COLOR_CORRECTION",m="SET_SETTING_FILTER_AMOUNT",v="SET_SETTING_BLUR_SIZE",E="SET_SETTING_BLUR_POSITION",y="SET_LAYER_FONT_SIZE",T=function(){return(T=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},C={isDataLoaded:!1,isShowDropBox:!1,isSaveLoading:!1,currentMode:p.default.TABS.STICKERS,currentStickerPackIndex:0,stickerHeaderScrollPosition:0},S=function(e,t){switch(void 0===e&&(e=C),t.type){case"SET_DATA_LOADED":return T(T({},e),{isDataLoaded:!0});case"SET_SHOW_DROP_BOX":return T(T({},e),{isShowDropBox:t.value});case"SET_SAVE_LOADING":return T(T({},e),{isSaveLoading:t.value});case"SET_CURRENT_TAB":return T(T({},e),{currentMode:t.value});case"SET_CURRENT_STICKER_PACK_INDEX":return T(T({},e),{currentStickerPackIndex:t.value});case"SET_HEADER_SCROLL_POSITION":return T(T({},e),{stickerHeaderScrollPosition:t.value});default:return e}},b=function(){return(b=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},w={color:p.default.COLORS[0],brushWidth:.5,brushOpacity:1,fontSize:.5,fontStyle:p.default.FONTS[0],filter:{name:p.default.PHOTO_FILTERS[0],value:.5},colorCorrection:{exposure:0,contrast:0,saturation:0,warmth:0,vignette:0,sharpness:0,grain:0},blur:{isEnabled:!1,form:p.default.BLUR_TYPES.ROUND,size:50,position:[.5,.5]},isAutoCorrection:!1,cropAspect:p.default.CROP_ASPECT_FREE,isCropped:!1,flipX:!1,flipY:!1,rotation:0},O=function(e,t){var r;switch(void 0===e&&(e=w),t.type){case"SET_SETTING_COLOR":return b(b({},e),{color:t.color});case"SET_SETTING_BRUSH_WIDTH":return b(b({},e),{brushWidth:t.brushWidth});case"SET_SETTING_BRUSH_OPACITY":return b(b({},e),{brushOpacity:t.brushOpacity});case"SET_SETTING_FONT_SIZE":return b(b({},e),{fontSize:t.fontSize});case"SET_SETTING_FONT_FAMILY":return b(b({},e),{fontStyle:t.fontStyle});case g:return b(b({},e),{colorCorrection:b(b({},e.colorCorrection),(r={},r[t.filter]=t.value,r))});case"SET_SETTING_FILTER":return b(b({},e),{filter:b(b({},e.filter),{name:t.name})});case m:return b(b({},e),{filter:b(b({},e.filter),{value:t.value})});case"SET_SETTING_BLUR_ENABLE":return b(b({},e),{blur:b(b({},e.blur),{isEnabled:t.isEnabled})});case"SET_SETTING_BLUR_FORM":return b(b({},e),{blur:b(b({},e.blur),{form:t.form})});case v:return b(b({},e),{blur:b(b({},e.blur),{size:t.size})});case E:return b(b({},e),{blur:b(b({},e.blur),{position:t.position})});case"SET_SETTING_AUTO_CORRECTION":return b(b({},e),{isAutoCorrection:t.isAutoCorrection});case"SET_SETTING_CROP_ASPECT":return b(b({},e),{cropAspect:t.aspect});case"SET_SETTING_CROPPED":return b(b({},e),{isCropped:t.isCropped});case"SET_SETTING_FLIP_X":return b(b({},e),{flipX:t.value});case"SET_SETTING_FLIP_Y":return b(b({},e),{flipY:t.value});case"SET_SETTING_ROTATE":return b(b({},e),{rotation:t.value});default:return e}},x=function(){return(x=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},P=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},A={currentIndex:null,items:[{canvas:document.createElement("canvas"),type:p.default.LAYER_TYPES.BACKGROUND,width:1,height:1,isBackground:!0,locked:!0,x:0,y:0,rotate:0,canDelete:!1,scale:1,avgColor:{r:128,g:128,b:128}}]},R=function(e,t){switch(void 0===e&&(e=A),t.type){case"SET_CURRENT_LAYER":return x(x({},e),{currentIndex:t.index});case"ADD_LAYER_STICKER":case"ADD_LAYER_TEXT":case"ADD_LAYER_IMAGE":return x(x({},e),{items:P(e.items,[t.payload])});case"SET_LAYER_POSITION":case"SET_LAYER_SCALE":case"SET_LAYER_COLOR":case y:case"SET_LAYER_FONT_STYLE":case"SET_LAYER_TEXT":case"TOGGLE_TEXT_EDITOR":return x(x({},e),{items:e.items.map((function(r,n){return e.currentIndex===n?x(x({},r),t.payload):r}))});case"START_LAYER_SCALE":return x({},e);case"UPDATE_BACKGROUND_LAYER":return x(x({},e),{items:e.items.map((function(e,r){return 0===r?x(x({},e),t.payload):e}))});case"DELETE_LAYER":return x(x({},e),{currentIndex:null,items:e.items.filter((function(e,r){return r!==t.index}))});case"UPDATE_LAYERS_AFTER_CROP":return x(x({},e),{items:t.items});default:return e}},L=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},N=function(e,t){switch(void 0===e&&(e=[]),t.type){case"ADD_VECTOR":return L(e,[t.payload]);case"UPDATE_DRAWING":return t.payload;default:return e}},I=function(){return(I=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},D={currentBackgroundType:p.default.BACKGROUND_MODES.BACKGROUND,currentPhotoUrl:null,currentBackgroundId:1},k=function(e,t){switch(void 0===e&&(e=D),t.type){case"SET_CURRENT_BACKGROUND_TYPE":return I(I({},e),{currentBackgroundType:t.value});case"SET_CURRENT_PHOTO_URL":return I(I({},e),{currentPhotoUrl:t.value});case"SET_CURRENT_BACKGROUND_ID":return I(I({},e),{currentBackgroundId:t.value});default:return e}},B=function(){return(B=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},M=function(e,t){switch(void 0===e&&(e={}),t.type){case"SET_DATA":return B(B({},e),t.payload);default:return e}},F=!1;var U=c()(Object(i.combineReducers)({ui:S,settings:O,layers:R,drawings:N,background:k,data:M}),{limit:100,syncFilter:!0,filter:Object(s.combineFilters)(Object(s.includeAction)([g,v,E,"SET_SETTING_BLUR_ENABLE","SET_SETTING_BLUR_FORM","SET_SETTING_AUTO_CORRECTION","SET_SETTING_FILTER",m,"ADD_LAYER_STICKER","ADD_LAYER_TEXT","DELETE_LAYER","ADD_VECTOR","SET_CURRENT_BACKGROUND_TYPE","SET_CURRENT_PHOTO_URL","SET_CURRENT_BACKGROUND_ID","SET_LAYER_COLOR",y,"SET_LAYER_FONT_STYLE","TOGGLE_TEXT_EDITOR","SET_SHOW_DROP_BOX","START_LAYER_SCALE"]),(function(e){return"TOGGLE_TEXT_EDITOR"===e.type?e.payload.isEdit:"SET_SHOW_DROP_BOX"===e.type?e.value:![g,m,v,E,y].includes(e.type)||(e.type!==h?(F=!1,h=e.type,!0):!F&&(F=!0,setTimeout((function(){F=!1}),500),!0))}))}),j=r("ufMw"),H=r("nAFc"),Y=r("jE6c"),G=function(e){return{type:"SET_CURRENT_LAYER",index:e}},W=function(e,t,r){return void 0===r&&(r=!0),function(n,o){var a=o().present.layers.items;n({type:e,payload:t}),r&&n(G(a.length))}},z=function(e,t){return function(r,n){var o,a=n().present,i=a.data,s=a.settings,c=_(n()),l=i.artboardWidth/2,u=i.artboardHeight/2-c,d=Object(H.decodeHTMLEntities)(i.placeholders[Object(Y.irand)(0,i.placeholders.length-1)]),f=0,h=!1,g=s.fontStyle,m=s.color,v=s.fontSize,E=1;t&&(l=void 0!==t.x?t.x:l,u=void 0!==t.y?t.y:u,d=void 0!==t.text?t.text:d,f=void 0!==t.rotate?t.rotate:f,h=void 0!==t.isEdit?t.isEdit:h,g=void 0!==t.style?t.style:g,m=void 0!==t.color?t.color:m,v=void 0!==t.fontSize?t.fontSize:v,o=t.initialFontSize,E=void 0!==t.scale?t.scale:E),Object(j.sendStat)(j.EVENTS.ADD_TEXT),e&&r(J(p.default.TABS.TEXT)),r(W("ADD_LAYER_TEXT",{type:p.default.LAYER_TYPES.TEXT,text:d,x:l,y:u,rotate:f,isEdit:h,fontSize:v,initialFontSize:o,fontStyle:g,color:m,scale:E,canDelete:!0},e))}},X=function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,a=n.items;null!==o&&a[o]&&t({type:"TOGGLE_TEXT_EDITOR",payload:{isEdit:e}})}},K=function(e){return{type:"UPDATE_BACKGROUND_LAYER",payload:e}},V=function(){return function(e,t){var r=t().present.layers,n=r.currentIndex,o=r.items;if(null!==n){var a=o[n];a&&(a.type===p.default.LAYER_TYPES.STICKER?Object(j.sendStat)(j.EVENTS.DELETE_STICKER):a.type===p.default.LAYER_TYPES.TEXT&&Object(j.sendStat)(j.EVENTS.DELETE_TEXT),e(q(!1)),e({type:"DELETE_LAYER",index:n}))}}},Z=function(){return function(e,t){var r=t().present.layers,n=r.currentIndex,o=r.items;if(null!==n){var a=o[n];a&&a.type===p.default.LAYER_TYPES.TEXT&&(o[n].text.trim()?e(X(!1)):e(V()))}}},q=function(e){return{type:"SET_SHOW_DROP_BOX",value:e}},J=function(e){return function(t,r){var n=r().present.layers,o=n.items,a=n.currentIndex;null!==a&&(o[a].type===p.default.LAYER_TYPES.TEXT&&t(Z()),[p.default.TABS.PAINT,p.default.TABS.FILTERS,p.default.TABS.COLOR,p.default.TABS.CROP].includes(e)&&t(G(null))),t({type:"SET_CURRENT_TAB",value:e})}},Q=function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,a=n.items;o&&!a[o]||t(function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,a=n.items;null!==o&&a[o]&&t({type:"SET_LAYER_COLOR",payload:{color:e}})}}(e)),t({type:"SET_SETTING_COLOR",color:e})}},$=function(e){return{type:"SET_SETTING_CROP_ASPECT",aspect:e}},ee=function(e){return{type:"SET_CURRENT_BACKGROUND_TYPE",value:e}},te=function(e){return{type:"SET_CURRENT_PHOTO_URL",value:e}},re=function(e){return{type:"SET_DATA",payload:e}},ne=function(e){return function(t){Object(a.batch)((function(){var r;e.hasOwnProperty("url")&&t(te(e.url)),e.hasOwnProperty("data")&&t(re(e.data)),e.hasOwnProperty("isCropped")&&t({type:"SET_SETTING_CROPPED",isCropped:e.isCropped}),e.hasOwnProperty("flipX")&&t((r=e.flipX,Object(j.sendStat)(j.EVENTS.FLIP_X),{type:"SET_SETTING_FLIP_X",value:r})),e.hasOwnProperty("flipY")&&t(function(e){return Object(j.sendStat)(j.EVENTS.FLIP_Y),{type:"SET_SETTING_FLIP_Y",value:e}}(e.flipY)),e.hasOwnProperty("rotate")&&t(function(e){return{type:"SET_SETTING_ROTATE",value:e}}(e.rotate)),e.hasOwnProperty("layers")&&t({type:"UPDATE_LAYERS_AFTER_CROP",items:e.layers}),e.hasOwnProperty("drawings")&&t(function(e){return{type:"UPDATE_DRAWING",payload:e}}(e.drawings))}))}},oe=r("i8i4");function ae(e){return new Promise((function(t,r){var n=new Image;n.crossOrigin="Anonymous",n.onerror=function(){r(new Error("Failed to load image's URL: "+e))},n.onload=function(){t(n)},n.src=e}))}function ie(e,t){if(!t)return{x:0,y:0,xOrigin:0,yOrigin:0,width:0,height:0};var r=t.getBoundingClientRect(),n=r.left,o=r.top,a=r.width,i=r.height;return{x:e.clientX-n,y:e.clientY-o,xOrigin:n,yOrigin:o,width:a,height:i}}function se(e,t){var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return r?"rgba("+parseInt(r[1],16)+", "+parseInt(r[2],16)+", "+parseInt(r[3],16)+", "+t+")":"rgba(0, 0, 0, 1)"}function ce(){return new Promise((function(e,t){var r=document.createElement("input");r.setAttribute("style","width: 0; height: 0; position: absolute; top: -1000px; left: -1000px; visibility: hidden"),r.value="",r.type="file",r.accept="image/*",r.onchange=function(r){var n=r.target;if(!n)return t();if(!n.files)return t();var o=n.files[0],a=URL.createObjectURL(o);ae(a).then((function(){(function(e){return new Promise((function(t){var r=new FileReader;r.onload=function(e){if(e.target){var r=e.target,n=new DataView(r.result);if(65496!=n.getUint16(0,!1))return t(-2);for(var o=n.byteLength,a=2;a<o;){if(n.getUint16(a+2,!1)<=8)return t(-1);var i=n.getUint16(a,!1);if(a+=2,65505==i){if(1165519206!=n.getUint32(a+=2,!1))return t(-1);var s=18761==n.getUint16(a+=6,!1);a+=n.getUint32(a+4,s);var c=n.getUint16(a,s);a+=2;for(var l=0;l<c;l++)if(274==n.getUint16(a+12*l,s))return t(n.getUint16(a+12*l+8,s))}else{if(65280!=(65280&i))break;a+=n.getUint16(a,!1)}}return t(-1)}},r.readAsArrayBuffer(e)}))})(o).then((function(r){-1===r||-2===r||1===r?e(a):function(e,t){return new Promise((function(r,n){var o=new Image;o.onload=function(){var e=o.width,a=o.height,i=document.createElement("canvas"),s=i.getContext("2d");if(!s)return n();switch(4<t&&t<9?(i.width=a,i.height=e):(i.width=e,i.height=a),t){case 2:s.transform(-1,0,0,1,e,0);break;case 3:s.transform(-1,0,0,-1,e,a);break;case 4:s.transform(1,0,0,-1,0,a);break;case 5:s.transform(0,1,1,0,0,0);break;case 6:s.transform(0,1,-1,0,a,0);break;case 7:s.transform(0,-1,-1,0,a,e);break;case 8:s.transform(0,-1,1,0,0,e)}s.drawImage(o,0,0),r(i.toDataURL())},o.src=e}))}(a,r).then((function(t){e(t)})).catch((function(){t()}))})).catch((function(){t()}))})).catch((function(){t()}))},r.onclick=function(){document.body.onfocus=function(){r.remove()}},document.body.appendChild(r),r.click()}))}function le(e,t,r,n,o,a,i){var s=0,c=0;switch(e){case"left_top":s=n+a,c=o+i;break;case"left_center":s=n+a,c=r/2+i;break;case"left_bottom":s=n+a,c=r-o+i;break;case"center_top":s=t/2+a,c=o+i;break;case"center":s=t/2+a,c=r/2+i;break;case"center_bottom":s=t/2+a,c=r-o+i;break;case"right_top":s=t-n+a,c=o+i;break;case"right_center":s=t-n+a,c=r/2+i;break;case"right_bottom":s=t-n+a,c=r-o+i}return{x:s,y:c}}function ue(e,t,r){var n=e.getContext("2d");n&&(n.clearRect(0,0,e.width,e.height),n.fillStyle="rgb(30, 30, 30)",n.fillRect(0,0,e.width,e.height),n.save(),n.filter="blur(135px)",n.drawImage(t,0,0,e.width,e.height),n.restore(),"none"!==n.filter&&(n.fillStyle="rgb("+r.r+", "+r.g+", "+r.b+")",n.fillRect(0,0,e.width,e.height)))}var pe,de=r("ZxpX"),fe=(pe=function(e,t){return(pe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}pe(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),_e=function(e){function t(t){var r=e.call(this,t)||this;return r.renderDrawings=function(){var e=r.props.drawings,t=r.canvas.current;if(t){var n=t.getContext("2d");if(n){var o=r.props.data.originalHeight/r.props.height;n.clearRect(0,0,t.width,t.height),n.lineCap="round",n.lineJoin="round",e.forEach((function(e){n.lineWidth=e.width*p.default.BRUSH_WIDTH_COEFFICIENT*o,n.strokeStyle=se(e.color,e.opacity),n.beginPath(),n.moveTo(e.path[0][0]*o,e.path[0][1]*o),e.path.forEach((function(e){n.lineTo(e[0]*o,e[1]*o)})),n.stroke()}))}}},r.drawStart=function(e){if(r.props.ui.currentMode===p.default.TABS.PAINT){window.addEventListener("mousemove",r.drawProcess),window.addEventListener("mouseup",r.drawFinish);var t=ie(e.nativeEvent,r.canvas.current),n=t.x,o=t.y;r.currentDrawing=[[n,o]];var a=r.props.settings;r.props.addDrawing({color:a.color,width:a.brushWidth,opacity:a.brushOpacity,path:r.currentDrawing}),r.renderDrawings()}},r.drawProcess=function(e){var t=ie(e,r.canvas.current),n=t.x,o=t.y;r.currentDrawing.push([n,o]),r.renderDrawings()},r.drawFinish=function(){window.removeEventListener("mousemove",r.drawProcess),window.removeEventListener("mouseup",r.drawFinish),r.currentDrawing=[]},r.canvas=n.createRef(),r.currentDrawing=[],r}return fe(t,e),t.prototype.render=function(){var e=this.props,t=e.data,r=e.width,o=e.height,a=e.ui,i=Object(de.classNames)("EditorCanvas__canvas","EditorCanvas__canvas--draw",{"EditorCanvas__canvas--disabled":a.currentMode!==p.default.TABS.PAINT});return n.createElement("canvas",{ref:this.canvas,className:i,onMouseDown:this.drawStart,width:t.originalWidth,height:t.originalHeight,style:{width:r,height:o}})},t.prototype.componentDidMount=function(){this.renderDrawings()},t.prototype.componentDidUpdate=function(){this.renderDrawings()},t}(n.PureComponent),he={addDrawing:function(e){return Object(j.sendStat)(j.EVENTS.ADD_GRAFFITI),{type:"ADD_VECTOR",payload:e}},addLayerText:z},ge=Object(a.connect)((function(e){return{ui:e.present.ui,settings:e.present.settings,drawings:e.present.drawings,data:e.present.data}}),he)(_e),me=new(function(){function e(){this.images={}}return e.prototype.get=function(e){var t=this;return new Promise((function(r,n){var o=t.images[e];o?r(o):ae(e).then((function(n){t.setImage(e,n),r(n)})).catch(n)}))},e.prototype.setImage=function(e,t){this.images[e]=t},e}()),ve="WebGL context not found",Ee="Create texture failed",ye="Shader compile failed",Te="Create program failed",Ce="Incomplete framebuffer",Se="Filter not found",be=function(e,t,r){var n=e.createShader(r);if(!n)throw new Error(ye);if(e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw new Error(""+e.getShaderInfoLog(n));this.shader=n},we=function(){function e(e,t,r){if(!e)throw new Error(ve);var n=e.createTexture();if(!n)throw new Error(Ee);this.texture=n,e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),t&&r&&this.updateSize(e,t,r),e.bindTexture(e.TEXTURE_2D,null)}return e.prototype.attachImage=function(e,t){e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.bindTexture(e.TEXTURE_2D,null)},e.prototype.updateSize=function(e,t,r){e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,r,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindTexture(e.TEXTURE_2D,null)},e.prototype.use=function(e,t){e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this.texture)},e.unuse=function(e,t){e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,null)},e.prototype.destroy=function(e){e.deleteTexture(this.texture)},e}(),Oe=r("t7n3"),xe=function(){function e(e,t,r){if(!e)throw new Error(ve);var n=new be(e,t,e.VERTEX_SHADER).shader,o=new be(e,r,e.FRAGMENT_SHADER).shader;this.gl=e,this.program=this.createProgram(n,o),this.framebuffer=e.createFramebuffer()}return e.prototype.createProgram=function(e,t){var r=this.gl.createProgram();if(!r)throw new Error(Te);if(this.gl.attachShader(r,e),this.gl.attachShader(r,t),this.gl.linkProgram(r),!this.gl.getProgramParameter(r,this.gl.LINK_STATUS))throw new Error(""+this.gl.getProgramInfoLog(r));return r},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e.prototype.attribute=function(e,t){var r=this.gl.getAttribLocation(this.program,e),n=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.STATIC_DRAW),this.gl.enableVertexAttribArray(r),this.gl.vertexAttribPointer(r,2,this.gl.FLOAT,!1,0,0)},e.prototype.uniforms=function(e){for(var t in this.gl.useProgram(this.program),e)if(e.hasOwnProperty(t)){var r=this.gl.getUniformLocation(this.program,t),n=e[t];if(Array.isArray(n))switch(n.length){case 1:this.gl.uniform1fv(r,new Float32Array(n));break;case 2:this.gl.uniform2fv(r,new Float32Array(n));break;case 3:this.gl.uniform3fv(r,new Float32Array(n));break;case 4:this.gl.uniform4fv(r,new Float32Array(n))}else Object(Oe.isNumber)(n)&&this.gl.uniform1f(r,n)}},e.prototype.textures=function(e,t){var r=this;this.gl.useProgram(this.program),e.forEach((function(e,n){t?(e.use(r.gl,n),r.gl.uniform1i(r.gl.getUniformLocation(r.program,"u_image"+n),n)):we.unuse(r.gl,n)}))},e.prototype.draw=function(e,t){this.gl.useProgram(this.program),t&&(t.updateSize(this.gl,e.width,e.height),this.bindTexture(t.texture)),this.gl.canvas.width=e.width,this.gl.canvas.height=e.height,this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight);var r=e.width,n=e.height;this.attribute("a_position",[0,0,r,0,0,n,0,n,r,0,r,n]),this.attribute("a_texCoord",[0,0,1,0,0,1,0,1,1,0,1,1]),this.uniforms(Object.assign(e.uniforms,{u_resolution:[e.width,e.height]})),e.textures&&this.textures(e.textures,!0),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,6),e.textures&&this.textures(e.textures,!1),t&&this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)},e.prototype.bindTexture=function(e,t){if(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.framebuffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,e,0),t){var r=this.gl.checkFramebufferStatus(this.gl.FRAMEBUFFER);if(r!==this.gl.FRAMEBUFFER_COMPLETE){var n="";switch(r){case this.gl.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:n="The attachment types are mismatched or not all framebuffer attachment points are framebuffer attachment complete.";break;case this.gl.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:n="There is no attachment.";break;case this.gl.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:n="Height and width of the attachment are not the same.";break;case this.gl.FRAMEBUFFER_UNSUPPORTED:n="The format of the attachment is not supported or if depth and stencil attachments are not the same renderbuffer."}throw new Error(Ce+". "+n)}}},e}(),Pe="attribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform vec2 u_resolution;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n\t// convert the rectangle from pixels to 0.0 to 1.0\n\tvec2 zeroToOne = a_position / u_resolution;\n\n\t// convert from 0->1 to 0->2\n\tvec2 zeroToTwo = zeroToOne * 2.0;\n\n\t// convert from 0->2 to -1->+1 (clipspace)\n\tvec2 clipSpace = zeroToTwo - 1.0;\n\n\tgl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n\n\t// pass the texCoord to the fragment shader\n\t// The GPU will interpolate this value between points.\n\tv_texCoord = a_texCoord;\n}\n",Ae=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},Re={regular:"/images/filters/maps/regular.png",nox:"/images/filters/maps/nox.png",vesper:"/images/filters/maps/vesper.png",latona:"/images/filters/maps/latona.png",liber:"/images/filters/maps/liber.png",luna:"/images/filters/maps/luna.png",minerva:"/images/filters/maps/minerva.png",mitra:"/images/filters/maps/mitra.png",pro:"/images/filters/maps/pro.png",terra:"/images/filters/maps/terra.png",veles:"/images/filters/maps/veles.png",vesta:"/images/filters/maps/vesta.png",zaria:"/images/filters/maps/zaria.png",sepia:"/images/filters/maps/sepia.png",genius:"/images/filters/maps/genius.png",horus:"/images/filters/maps/horus.png",fortuna:"/images/filters/maps/fortuna.png"},Le=["/images/filters/maps/contrast_negative.png","/images/filters/maps/contrast_positive.png","/images/filters/maps/exposure_negative.png","/images/filters/maps/exposure_positive.png","/images/filters/maps/warm_negative_lut.png","/images/filters/maps/warm_positive_lut.png"];var Ne=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},Ie={preserveDrawingBuffer:!0,premultipliedAlpha:!1},De=document.createElement("canvas"),ke=De.getContext("webgl",Ie)||De.getContext("experimental-webgl",Ie),Be={},Me=function(){function e(){this.baseColorCorrectionProgram=new xe(ke,Pe,"precision mediump float;\n\nvarying vec2 v_texCoord;\n\nuniform sampler2D u_image0; // image\nuniform sampler2D u_image1; // contrast_negative.png\nuniform sampler2D u_image2; // contrast_positive.png\nuniform sampler2D u_image3; // exposure_negative.png\nuniform sampler2D u_image4; // exposure_positive.png\nuniform sampler2D u_image5; // warm_negative_lut.png\nuniform sampler2D u_image6; // warm_positive_lit.png\nuniform sampler2D u_image7; // color table\n\nuniform float u_exposure;\nuniform float u_contrast;\nuniform float u_saturation;\nuniform float u_warmth;\nuniform float u_amount;\n\nvec3 ContrastSaturationBrightness(vec3 color, float brt, float sat, float con) {\n\tconst float AvgLumR = 0.5;\n\tconst float AvgLumG = 0.5;\n\tconst float AvgLumB = 0.5;\n\n\tconst vec3 LumCoeff = vec3(0.2125, 0.7154, 0.0721);\n\n\tvec3 AvgLumin = vec3(AvgLumR, AvgLumG, AvgLumB);\n\tvec3 brtColor = color * brt;\n\tvec3 intensity = vec3(dot(brtColor, LumCoeff));\n\tvec3 satColor = mix(intensity, brtColor, sat);\n\tvec3 conColor = mix(AvgLumin, satColor, con);\n\n\treturn conColor;\n}\n\nfloat BF_SoftLight(float base, float blend) {\n\treturn 2.0 * base * blend + base * base * (1.0 - 2.0 * blend);\n}\n\nvec3 BF_SoftLight(vec3 base, vec3 blend) {\n\treturn vec3(BF_SoftLight(base.r, blend.r), BF_SoftLight(base.g, blend.g), BF_SoftLight(base.b, blend.b));\n}\n\nvec3 Exposure(vec3 view, float intensity) {\n\tvec3 exposure1;\n\texposure1.r = texture2D(u_image3, vec2(view.r, 0.5)).r;\n\texposure1.g = texture2D(u_image3, vec2(view.g, 0.5)).g;\n\texposure1.b = texture2D(u_image3, vec2(view.b, 0.5)).b;\n\n\tvec3 exposure2;\n\texposure2.r = texture2D(u_image4, vec2(view.r, 0.5)).r;\n\texposure2.g = texture2D(u_image4, vec2(view.g, 0.5)).g;\n\texposure2.b = texture2D(u_image4, vec2(view.b, 0.5)).b;\n\n\tvec3 result;\n\tif (intensity >= 0.0) {\n\t\tresult = mix(view, exposure2, intensity);\n\t} else {\n\t\tresult = mix(view, exposure1, -intensity);\n\t}\n\n\treturn result;\n}\n\nvec3 Contrast(vec3 view, float intensity) {\n\tvec3 contrast1;\n\tcontrast1.r = texture2D(u_image1, vec2(view.r, 0.5)).r;\n\tcontrast1.g = texture2D(u_image1, vec2(view.g, 0.5)).g;\n\tcontrast1.b = texture2D(u_image1, vec2(view.b, 0.5)).b;\n\n\tvec3 contrast2;\n\tcontrast2.r = texture2D(u_image2, vec2(view.r, 0.5)).r;\n\tcontrast2.g = texture2D(u_image2, vec2(view.g, 0.5)).g;\n\tcontrast2.b = texture2D(u_image2, vec2(view.b, 0.5)).b;\n\n\tvec3 result;\n\tif (intensity >= 0.0) {\n\t\tresult = mix(view, contrast2, intensity);\n\t} else {\n\t\tresult = mix(view, contrast1, -intensity);\n\t}\n\n\treturn result;\n}\n\nvec3 ColorTemp(vec3 view, float intensity) {\n\tfloat blueColor = view.b * 63.0;\n\n\tvec2 quad1;\n\tquad1.y = floor(floor(blueColor) / 8.0);\n\tquad1.x = floor(blueColor) - (quad1.y * 8.0);\n\n\tvec2 quad2;\n\tquad2.y = floor(ceil(blueColor) / 8.0);\n\tquad2.x = ceil(blueColor) - (quad2.y * 8.0);\n\n\tvec2 texPos1;\n\ttexPos1.x = (quad1.x * 0.125) + 0.5 / 960.0 + ((0.125 - 1.0 / 960.0) * view.r);\n\ttexPos1.y = (quad1.y * 0.125) + 0.5 / 960.0 + ((0.125 - 1.0 / 960.0) * view.g);\n\n\tvec2 texPos2;\n\ttexPos2.x = (quad2.x * 0.125) + 0.5 / 960.0 + ((0.125 - 1.0 / 960.0) * view.r);\n\ttexPos2.y = (quad2.y * 0.125) + 0.5 / 960.0 + ((0.125 - 1.0 / 960.0) * view.g);\n\n\tvec3 coldColor1 = texture2D(u_image5, texPos1).rgb;\n\tvec3 coldColor2 = texture2D(u_image5, texPos2).rgb;\n\tvec3 coldColor = mix(coldColor1, coldColor2, fract(blueColor));\n\n\tvec3 warmColor1 = texture2D(u_image6, texPos1).rgb;\n\tvec3 warmColor2 = texture2D(u_image6, texPos2).rgb;\n\tvec3 warmColor = mix(warmColor1, warmColor2, fract(blueColor));\n\n\tvec3 result;\n\n\tif (intensity >= 0.0) {\n\t\tresult = mix(view, warmColor, intensity);\n\t} else {\n\t\tresult = mix(view, coldColor, -intensity);\n\t}\n\n\treturn result;\n}\n\nvec3 Saturation(vec3 view, float intensity) {\n\treturn ContrastSaturationBrightness(view, 1.0, intensity, 1.0);\n}\n\nvec3 Lut(vec3 view, sampler2D tex, float intensity) {\n\tfloat blueColor = view.b * 63.0;\n\n\tvec2 quad1;\n\tquad1.y = floor(floor(blueColor) / 8.0);\n\tquad1.x = floor(blueColor) - (quad1.y * 8.0);\n\n\tvec2 quad2;\n\tquad2.y = floor(ceil(blueColor) / 8.0);\n\tquad2.x = ceil(blueColor) - (quad2.y * 8.0);\n\n\tvec2 texPos1;\n\ttexPos1.x = (quad1.x * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * view.r);\n\ttexPos1.y = (quad1.y * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * view.g);\n\n\tvec2 texPos2;\n\ttexPos2.x = (quad2.x * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * view.r);\n\ttexPos2.y = (quad2.y * 0.125) + 0.5 / 512.0 + ((0.125 - 1.0 / 512.0) * view.g);\n\n\tvec3 newColor1 = texture2D(tex, texPos1).rgb;\n\tvec3 newColor2 = texture2D(tex, texPos2).rgb;\n\n\tvec3 newColor = mix(newColor1, newColor2, fract(blueColor));\n\tvec3 color = mix(view, newColor, intensity);\n\n\treturn color;\n}\n\n// [-1.0; 1.0]\nvec3 pExposure(vec3 view, float intensity) {\n\tintensity = clamp(intensity, -1.0, 1.0);\n\treturn Exposure(view, intensity);\n}\n\n// [-1.0; 1.0]\nvec3 pContrast(vec3 view, float intensity) {\n\tintensity = clamp(intensity, -1.0, 1.0);\n\treturn Contrast(view, intensity);\n}\n\n// [-1.0; 1.0]\nvec3 pColorTemp(vec3 view, float intensity) {\n\tintensity = clamp(intensity, -1.0, 1.0);\n\treturn ColorTemp(view, intensity);\n}\n\n// [-1.0; 1.0]\nvec3 pSaturation(vec3 view, float intensity) {\n\tvec2 range = vec2(0.0, 1.6);\n\tintensity = clamp(intensity, -1.0, 1.0);\n\tintensity = (intensity >= 0.0) ? 1.0 + (range.y - 1.0) * intensity : range.x + (1.0 - range.x) * (intensity + 1.0);\n\treturn Saturation(view, intensity);\n}\n\n// [0.0; 1.0]\nvec3 pLut(vec3 view,sampler2D tex, float intensity) {\n\tvec2 range = vec2(0.0, 1.0);\n\tintensity = clamp(intensity, 0.0, 1.0);\n\treturn Lut(view, tex, intensity);\n}\n\nvoid main() {\n\t// Хак для того, чтобы перевернуть текстуру\n\tvec2 texelCoord = v_texCoord;\n\ttexelCoord.y = 1. - texelCoord.y;\n\n\tvec4 texture = texture2D(u_image0, texelCoord);\n\n\ttexture.rgb = pColorTemp(texture.rgb, u_warmth);\n\ttexture.rgb = pLut(texture.rgb, u_image7, u_amount);\n\ttexture.rgb = pExposure(texture.rgb, u_exposure);\n\ttexture.rgb = pContrast(texture.rgb, u_contrast);\n\ttexture.rgb = pSaturation(texture.rgb, u_saturation);\n\n\tgl_FragColor = texture;\n}\n"),this.postProcessProgram=new xe(ke,Pe,"precision mediump float;\n\nvarying vec2 v_texCoord;\n\nuniform sampler2D u_image0;\n\nuniform float u_vignette;\nuniform float u_sharpness;\nuniform float u_grain;\n\nuniform vec2 u_sourceSize;\n\nvec4 rnm(in vec2 tc) {\n\tfloat timer = 0.4;\n\tfloat noise = sin(dot(tc + vec2(timer, timer), vec2(12.9898, 78.233))) * 43758.5453;\n\n\tfloat noiseR = fract(noise) * 2.0 - 1.0;\n\tfloat noiseG = fract(noise * 1.2154) * 2.0 - 1.0;\n\tfloat noiseB = fract(noise * 1.3453) * 2.0 - 1.0;\n\tfloat noiseA = fract(noise * 1.3647) * 2.0 - 1.0;\n\n\treturn vec4(noiseR,noiseG,noiseB,noiseA);\n}\n\nfloat fade(in float t) {\n\treturn t * t * t * (t * (t * 6.0 - 15.0) + 10.0);\n}\n\nfloat pnoise3D(in vec3 p) {\n\tvec3 pi = 0.00195313 * floor(p) + 0.00195313;\n\tvec3 pf = fract(p); // Fractional part for interpolation\n\n\t// Noise contributions from (x=0, y=0), z=0 and z=1\n\tfloat perm00 = rnm(pi.xy).a ;\n\tvec3  grad000 = rnm(vec2(perm00, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n000 = dot(grad000, pf);\n\tvec3  grad001 = rnm(vec2(perm00, pi.z + 0.00195313)).rgb * 4.0 - 1.0;\n\tfloat n001 = dot(grad001, pf - vec3(0.0, 0.0, 1.0));\n\n\t// Noise contributions from (x=0, y=1), z=0 and z=1\n\tfloat perm01 = rnm(pi.xy + vec2(0.0, 0.00195313)).a ;\n\tvec3  grad010 = rnm(vec2(perm01, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n010 = dot(grad010, pf - vec3(0.0, 1.0, 0.0));\n\tvec3  grad011 = rnm(vec2(perm01, pi.z + 0.00195313)).rgb * 4.0 - 1.0;\n\tfloat n011 = dot(grad011, pf - vec3(0.0, 1.0, 1.0));\n\n\t// Noise contributions from (x=1, y=0), z=0 and z=1\n\tfloat perm10 = rnm(pi.xy + vec2(0.00195313, 0.0)).a ;\n\tvec3  grad100 = rnm(vec2(perm10, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n100 = dot(grad100, pf - vec3(1.0, 0.0, 0.0));\n\tvec3  grad101 = rnm(vec2(perm10, pi.z + 0.00195313)).rgb * 4.0 - 1.0;\n\tfloat n101 = dot(grad101, pf - vec3(1.0, 0.0, 1.0));\n\n\t// Noise contributions from (x=1, y=1), z=0 and z=1\n\tfloat perm11 = rnm(pi.xy + vec2(0.00195313, 0.00195313)).a ;\n\tvec3  grad110 = rnm(vec2(perm11, pi.z)).rgb * 4.0 - 1.0;\n\tfloat n110 = dot(grad110, pf - vec3(1.0, 1.0, 0.0));\n\tvec3  grad111 = rnm(vec2(perm11, pi.z + 0.00195313)).rgb * 4.0 - 1.0;\n\tfloat n111 = dot(grad111, pf - vec3(1.0, 1.0, 1.0));\n\n\t// Blend contributions along x\n\tvec4 n_x = mix(vec4(n000, n001, n010, n011), vec4(n100, n101, n110, n111), fade(pf.x));\n\n\t// Blend contributions along y\n\tvec2 n_xy = mix(n_x.xy, n_x.zw, fade(pf.y));\n\n\t// Blend contributions along z\n\tfloat n_xyz = mix(n_xy.x, n_xy.y, fade(pf.z));\n\n\t// We're done, return the final noise value.\n\treturn n_xyz;\n}\n\n//2d coordinate orientation thing\nvec2 coordRot(in vec2 tc, in float angle) {\n\tfloat aspect = u_sourceSize.x / u_sourceSize.y;\n\tvec2 uv = (tc * 2.0) - 1.0;\n\tfloat rotX = (uv.x * aspect * cos(angle)) - (uv.y * sin(angle));\n\tfloat rotY = (uv.y * cos(angle)) + (uv.x * aspect * sin(angle));\n\trotX = ((rotX / aspect) * 0.5 + 0.5);\n\trotY = rotY * 0.5 + 0.5;\n\treturn vec2(rotX, rotY);\n}\n\nvec3 BF_Multiply(vec3 base, vec3 blend) {\n\treturn base * blend;\n}\n\nfloat BF_Screen(float base, float blend) {\n\treturn 1.0 - ((1.0 - base) * (1.0 - blend));\n}\n\nvec3 BF_Screen(vec3 base, vec3 blend) {\n\treturn 1.0 - ((1.0 - base) * (1.0 - blend));\n}\n\nvec3 Sharpness(vec3 view, float intensity) {\n\tvec2 uv = v_texCoord;\n\tvec2 step = 1.0 / u_sourceSize;\n\n\tvec3 texA = texture2D(u_image0, uv + vec2(-step.x, -step.y) * 1.0).rgb;\n\tvec3 texB = texture2D(u_image0, uv + vec2( step.x, -step.y) * 1.0).rgb;\n\tvec3 texC = texture2D(u_image0, uv + vec2(-step.x,  step.y) * 1.0).rgb;\n\tvec3 texD = texture2D(u_image0, uv + vec2( step.x,  step.y) * 1.0).rgb;\n\n\tvec3 around = 0.25 * (texA + texB + texC + texD);\n\tvec3 center  = texture2D(u_image0, uv ).rgb;\n\tvec3 col = center + (center - around) * intensity;\n\n\treturn col;\n}\n\nvec3 Grain(vec3 view, float intensity) {\n\tvec2 texCoord = v_texCoord;\n\n\tfloat timer = 0.4;\n\tfloat coloramount = 0.4;\n\tfloat grainsize = 2.0;\n\tfloat lumamount = 0.3;\n\n\tbool colored = true;\n\n\tvec3 rotOffset = vec3(1.425, 3.892, 5.835); // rotation offset values\n\tvec2 rotCoordsR = coordRot(texCoord, timer + rotOffset.x);\n\tvec3 noise = vec3(pnoise3D(vec3(rotCoordsR * vec2(u_sourceSize.x / grainsize, u_sourceSize.y / grainsize), 0.0)));\n\n\tif (colored) {\n\t\tvec2 rotCoordsG = coordRot(texCoord, timer + rotOffset.y);\n\t\tvec2 rotCoordsB = coordRot(texCoord, timer + rotOffset.z);\n\t\tnoise.g = mix(noise.r, pnoise3D(vec3(rotCoordsG * vec2(u_sourceSize.x / grainsize, u_sourceSize.y / grainsize), 1.0)), coloramount);\n\t\tnoise.b = mix(noise.r, pnoise3D(vec3(rotCoordsB * vec2(u_sourceSize.x / grainsize, u_sourceSize.y / grainsize), 2.0)), coloramount);\n\t}\n\n\tvec3 col = view.rgb;\n\tvec3 lumcoeff = vec3(0.299, 0.587, 0.114);\n\tfloat luminance = lumamount * dot(col, lumcoeff);\n\tfloat lum = smoothstep(0.2, 0.0, luminance);\n\n\tlum += luminance;\n\tnoise = mix(noise, vec3(0.0), pow(lum, 4.0));\n\tcol = col + noise * intensity;\n\n\treturn col;\n}\n\nvec3 Vignette(vec3 view, float intensity) {\n\tfloat inten = abs(intensity);\n\tfloat dist = distance(v_texCoord, vec2(0.5, 0.5));\n\tfloat size = 0.5 - inten * 0.4;\n\tfloat amount = inten * inten * 0.1 + 0.5 * inten;\n\tfloat vignette = smoothstep(0.8, size * 0.799, dist * (amount + size));\n\treturn (intensity >= 0.0) ? view * vignette : BF_Screen(view,vec3(1.0-vignette));\n}\n\n// [-1; 1]\nvec3 pSharpness(vec3 view, float intensity) {\n\tvec2 range = vec2(0.0, 1.5);\n\tintensity = clamp(intensity, 0.0, 1.0);\n\tintensity = (intensity >= 0.0) ? range.y * intensity : -range.x * (intensity+1.0) + range.x;\n\treturn Sharpness(view, intensity);\n}\n\n// [0; 1]\nvec3 pGrain(vec3 view, float intensity) {\n\tvec2 range = vec2(0.0, 0.2);\n\n\tintensity = clamp(intensity, 0.0, 1.0);\n\tintensity = (intensity >= 0.0) ? range.y * intensity : -range.x * (intensity + 1.0) + range.x;\n\treturn Grain(view, intensity);\n}\n\n// [-1; 1]\nvec3 pVignette(vec3 view, float intensity) {\n\tvec2 range = vec2(-1.0, 1.0);\n\tintensity = clamp(intensity, -1.0, 1.0);\n\tintensity = (intensity >= 0.0) ? range.y * intensity : -range.x * (intensity + 1.0) + range.x;\n\treturn Vignette(view, intensity);\n}\n\nvoid main() {\n\tvec4 texture = texture2D(u_image0, v_texCoord);\n\n\ttexture.rgb = pSharpness(texture.rgb, u_sharpness);\n\ttexture.rgb = pVignette(texture.rgb, u_vignette);\n\ttexture.rgb = pGrain(texture.rgb, u_grain);\n\n\tgl_FragColor = texture;\n}\n"),this.flippedProgram=new xe(ke,Pe,"precision mediump float;\n\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\n\nvoid main() {\n\tvec4 color = texture2D(u_texture, vec2(v_texCoord.x, 1.0 - v_texCoord.y));\n\tgl_FragColor = color;\n}\n"),this.triangleBlurProgram=new xe(ke,Pe,"precision mediump float;\n\nuniform sampler2D u_image0; // original image\nuniform vec2 u_delta;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n\tvec4 color = vec4(0.0);\n\tfloat total = 0.0;\n\tfloat offset = fract(sin(dot(gl_FragCoord.xyz, vec3(12.9898, 78.233, 151.7182))) * 43758.5453);\n\n\tfor (float t = -30.0; t <= 30.0; t++) {\n\t\tfloat percent = (t + offset - 0.5) / 30.0;\n\t\tfloat weight = 1.0 - abs(percent);\n\t\tvec4 sampleColor = texture2D(u_image0, v_texCoord + u_delta * percent);\n\t\tsampleColor.rgb *= sampleColor.a;\n\n\t\tcolor += sampleColor * weight;\n\t\ttotal += weight;\n\t}\n\n\tcolor = color / total;\n\tcolor.rgb /= color.a + 0.00001;\n\tgl_FragColor = color;\n}\n"),this.roundBlurProgram=new xe(ke,Pe,"precision mediump float;\n\nuniform sampler2D u_image0; // blurred image\nuniform sampler2D u_image1; // original image\nuniform vec2 u_position;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n\t// Хак для того, чтобы перевернуть текстуру\n\tvec2 texelCoord = v_texCoord;\n\ttexelCoord.y = 1. - texelCoord.y;\n\n\tvec4 color = texture2D(u_image0, texelCoord);\n\tfloat distanceFromCenter = distance(u_position, texelCoord);\n\n\tcolor = mix(texture2D(u_image1, texelCoord), color, clamp(smoothstep(0.3 - 0.2, 0.3, distanceFromCenter), 0.0, 1.0));\n\tgl_FragColor = color;\n}\n"),this.squareBlurProgram=new xe(ke,Pe,"precision mediump float;\n\nuniform sampler2D u_image0; // blurred image\nuniform sampler2D u_image1; // original image\nuniform vec2 u_position;\n\nvarying vec2 v_texCoord;\n\nvoid main() {\n\t// Хак для того, чтобы перевернуть текстуру\n\tvec2 texelCoord = v_texCoord;\n\ttexelCoord.y = 1. - texelCoord.y;\n\n\tvec4 color = texture2D(u_image0, texelCoord);\n\tvec2 realPosition = u_position;\n\trealPosition.x = texelCoord.x;\n\n\tfloat distanceFromCenter = distance(realPosition, texelCoord);\n\tcolor = mix(texture2D(u_image1, texelCoord), color, clamp(smoothstep(0.2 - 0.1, 0.2, distanceFromCenter), 0.0, 1.0));\n\n\tgl_FragColor = color;\n}\n"),this.colorCorrectionTexture=new we(ke),this.postProcessTexture=new we(ke),this.blurTexture1=new we(ke),this.blurTexture2=new we(ke),this.resultBlurTexture=new we(ke)}return e.getOrCreateTexture=function(t,r,n){var o=n?r.src+"_auto":r.src;if(!Be[o]){var a=void 0;a=n?e.getAuto(r):r;var i=new we(t);i.attachImage(t,a),Be[o]=i}return Be[o]},e.loadTextures=function(t,r){return new Promise((function(n){var o=[],a=r.map((function(e){return me.get(e)}));Promise.all(a).then((function(r){r.forEach((function(r){var n=e.getOrCreateTexture(t,r);o.push(n)})),n(o)})).catch((function(){}))}))},e.getAuto=function(e){var t=document.createElement("canvas"),r=t.getContext("2d");if(!r)return t;t.width=e.width,t.height=e.height,r.drawImage(e,0,0,e.width,e.height);var n=e.width*e.height,o=r.getImageData(0,0,e.width,e.height),a=o.data;function i(e,t,r,n){t+r>=e&&(t=(e-1)/2,r=(e-1)/2);var o=function(e,t,r,n){for(var o,i=[],s=0;s<256;s++)i.push(0);for(o=0;o<e;o++)i[a[4*o+n]]+=1;for(o=1;o<256;o++)i[o]+=i[o-1];var c={};for(o=0;o<256&&i[o]<=t;)o++;for(c.min=o,o=255;o<256&&i[o]>e-r;)o--;return o<255&&o++,c.max=o,c}(e,t,r,n);!function(e,t,r,n){var o,i;if(r<=t)for(o=0;o<e;o++)a[(i=4*o)+n]=127.5;else{var s=new Array(256);for(o=0;o<t;o++)s[o]=0;for(o=t;o<r;o++)s[o]=255*(o-t)/(r-t)+.5;for(o=r;o<256;o++)s[o]=255;for(o=0;o<e;o++)a[(i=4*o)+n]=s[a[i+n]]}}(e,o.min,o.max,n)}!function(e,t,r){i(e,t,r,0),i(e,t,r,1),i(e,t,r,2)}(n,.01*n,.01*n),r.putImageData(o,0,0);var s=document.createElement("canvas");return s.width=e.width,s.height=e.height,null==(r=s.getContext("2d"))||r.drawImage(t,0,0,t.width,t.height),t},e.prototype.render=function(t,r,n,o,a,i,s){var c=this;return void 0===a&&(a={}),new Promise((function(l){requestAnimationFrame((function(){if(!ke)throw new Error(ve);var u=function(e){var t=Re[e];if(t)return Ae(Le,[t])}(o);if(!u)throw new Error(Se);var d=e.getOrCreateTexture(ke,n,s);e.loadTextures(ke,u).then((function(e){var n=c.postProcessTexture;if(c.baseColorCorrectionProgram.draw({width:t,height:r,uniforms:{u_exposure:a.exposure,u_contrast:a.contrast,u_warmth:a.warmth,u_saturation:a.saturation,u_amount:a.amount},textures:Ne([d],e)},c.colorCorrectionTexture),c.postProcessProgram.draw({width:t,height:r,uniforms:{u_vignette:a.vignette,u_sharpness:a.sharpness,u_sourceSize:a.sourceSize,u_grain:a.grain},textures:[c.colorCorrectionTexture]},c.postProcessTexture),i&&i.isEnabled){var o=i.form===p.default.BLUR_TYPES.ROUND?c.roundBlurProgram:c.squareBlurProgram;c.triangleBlurProgram.draw({width:t,height:r,uniforms:{u_delta:[i.size/t,0]},textures:[c.postProcessTexture]},c.blurTexture1),c.triangleBlurProgram.draw({width:t,height:r,uniforms:{u_delta:[0,i.size/r]},textures:[c.blurTexture1]},c.blurTexture2),o.draw({width:t,height:r,uniforms:{u_position:i.position},textures:[c.blurTexture2,c.postProcessTexture]},c.resultBlurTexture),n=c.resultBlurTexture}return c.flippedProgram.draw({width:t,height:r,uniforms:{},textures:[n]}),l(De)})).catch((function(e){console.error(new Error(e))}))}))}))},e}(),Fe=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ue={},je=function(e){function t(t){var r=e.call(this,t)||this;return r.canvas=n.createRef(),r.renderer=new Me,r.needUpdateSize=!0,r}return Fe(t,e),t.prototype.componentDidMount=function(){this.update()},t.prototype.componentDidUpdate=function(e){var t=this.props,r=t.originalWidth,n=t.originalHeight,o=t.background,a=r!==e.originalWidth||n!==e.originalHeight;this.needUpdateSize=a||JSON.stringify(o)!==JSON.stringify(e.background),this.update()},t.prototype.render=function(){var e=this.props,t=e.originalWidth,r=e.originalHeight;return n.createElement("canvas",{ref:this.canvas,className:"EditorCanvas__canvas EditorCanvas__canvas--bg",width:t,height:r,style:{width:this.props.width,height:this.props.height}})},t.prototype.update=function(){var e=this,t=this.props.currentBackgroundUrl;t&&me.get(t).then((function(t){e.renderImage(t)})).catch((function(e){console.error(e)}))},t.prototype.renderImage=function(e){var t=this,r=this.canvas.current;if(r&&r.getContext("2d")){var n=this.props.background,o=this.props,a=o.colorCorrection,i=o.filter,s=o.blur,c=o.isAutoCorrection;n.currentBackgroundType===p.default.BACKGROUND_MODES.BACKGROUND&&(i={name:p.default.PHOTO_FILTERS[0],value:0},a={exposure:0,contrast:0,saturation:0,warmth:0,vignette:0,sharpness:0,grain:0},s={isEnabled:!1,form:s.form,size:s.size,position:s.position},c=!1);var l={exposure:a.exposure,contrast:a.contrast,saturation:a.saturation,warmth:a.warmth,amount:i.value,vignette:a.vignette,sharpness:a.sharpness,grain:a.grain,sourceSize:[e.width,e.height]};this.renderer.render(e.width,e.height,e,i.name,l,s,c).then((function(n){if(n){var o,a,i=e.height/e.width;i>1.77?(o=t.props.height/i,a=t.props.height):(o=t.props.width,a=t.props.width*i);var s=Math.floor(t.props.width/2),c=Math.floor(t.props.height/2),l=function(e){var t=document.createElement("canvas"),r=t.getContext("2d");return t.width=e.width,t.height=e.height,null==r||r.drawImage(e,0,0,e.width,e.height),t}(n),u=Ue[e.src];u||(Ue[e.src]=function(e){var t,r=e.getContext("2d"),n={r:0,g:0,b:0};if(!r)return n;try{t=r.getImageData(0,0,r.canvas.width,r.canvas.height)}catch(e){return n}for(var o=-4,a=0;(o+=20)<t.data.length;)++a,n.r+=t.data[o],n.g+=t.data[o+1],n.b+=t.data[o+2];return n.r=~~(n.r/a),n.g=~~(n.g/a),n.b=~~(n.b/a),n}(l),u=Ue[e.src]),ue(r,l,u);var p={canvas:l,width:o,height:a,avgColor:u};t.needUpdateSize&&Object.assign(p,{x:s,y:c,locked:!0,rotate:0,scale:1}),t.props.updateBackgroundLayer(p)}})).catch((function(e){console.error(new Error(e))}))}},t}(n.PureComponent),He={updateBackgroundLayer:K},Ye=Object(a.connect)((function(e){return{currentBackgroundUrl:f(e),originalWidth:e.present.data.originalWidth,originalHeight:e.present.data.originalHeight,background:e.present.background,isAutoCorrection:e.present.settings.isAutoCorrection,colorCorrection:e.present.settings.colorCorrection,filter:e.present.settings.filter,blur:e.present.settings.blur}}),He)(je),Ge=r("4+be"),We=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ze=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},Xe=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidUpdate=function(){r.scrollWithAnimation=!1},r.render=function(){var e,t=r.props.layers,o=t.currentIndex,a=t.items,i=null!==o&&a[o],s=i&&i.type===p.default.LAYER_TYPES.TEXT&&i.isEdit,c="";return i&&(i.type===p.default.LAYER_TYPES.STICKER?c=Object(Ge.getLang)("photos_pe_delete_sticker"):i.type===p.default.LAYER_TYPES.TEXT&&(c=Object(Ge.getLang)("photos_pe_delete_text"))),r.props.currentBackgroundType!==p.default.BACKGROUND_MODES.BACKGROUND||i||(e=!0),n.createElement("div",{className:"StatusPanel"},e?r.renderBackgrounds():n.createElement("div",{className:"StatusPanel__inner"},r.renderLeftBlock(),n.createElement("div",null,i&&!s&&n.createElement("a",{className:"StatusPanel__link",onClick:r.props.deleteLayer},c),i&&s&&n.createElement("a",{className:"StatusPanel__link",onClick:r.props.closeTextEditor},Object(Ge.getLang)("photos_pe_save_text")))))},r.renderLeftBlock=function(){var e=r.props.addons;return"photo"===r.props.context?n.createElement("div",null,e&&e.edited&&e.canEdit&&n.createElement("a",{className:"StatusPanel__link",onClick:e.restore},Object(Ge.getLang)("photos_filtered_restore")),e&&!e.canEdit&&n.createElement("span",{className:"StatusPanel__info"},Object(Ge.getLang)("photos_will_be_saved_to_pe_album"))):n.createElement("div",null,r.props.currentBackgroundType===p.default.BACKGROUND_MODES.PHOTO&&n.createElement("a",{className:"StatusPanel__link",onClick:function(){return r.props.uploadPhoto()}},Object(Ge.getLang)("photos_pe_change_photo")))},r.renderBackgrounds=function(){var e=r.state.scrollBlockPosition,t=r.props.backgrounds,o=t.gradients,a=t.emojies,i=r.scrollElement.current,s=i?e+i.offsetWidth:0,c=!!e,l=!i||!!(i.scrollWidth-s);return n.createElement("div",{className:"StatusPanel__backgrounds",onWheel:r.panelMouseWheel},n.createElement("div",{className:"StatusPanel__scroll",style:{transform:"translateX(-"+e+"px)",transition:r.scrollWithAnimation?"transform .3s ease-out":""},ref:r.scrollElement},ze(o,a).map((function(e){var t=e.id,o=e.preview;return n.createElement("a",{className:Object(de.classNames)("StatusPanel__background",{"StatusPanel__background--active":t===r.props.currentBackgroundId}),key:t,style:{backgroundImage:"url("+o+")"},onClick:function(){return r.props.setCurrentBackgroundId(t)}})}))),c&&n.createElement("div",{className:"StatusPanel__arrow StatusPanel__arrow--left",onClick:function(){return r.handleArrowClick(!0)}},n.createElement("span",{className:"StatusPanel__arrowIcon"})),l&&n.createElement("div",{className:"StatusPanel__arrow StatusPanel__arrow--right",onClick:function(){return r.handleArrowClick(!1)}},n.createElement("span",{className:"StatusPanel__arrowIcon"})))},r.panelMouseWheel=function(e){r.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},r.setPosition=function(e,t){var n=r.scrollElement.current;if(n){var o=r.state.scrollBlockPosition,a=n.offsetWidth,i=Math.max(0,Math.min(o+e,n.scrollWidth-a));t&&(r.scrollWithAnimation=!0),r.setState({scrollBlockPosition:i})}},r.handleArrowClick=function(e){var t=r.scrollElement.current;if(t){var n=t.offsetWidth/2;e&&(n=-n),r.setPosition(n,!0)}},r.state={scrollBlockPosition:0},r.scrollElement=n.createRef(),r.scrollWithAnimation=!1,r}return We(t,e),t}(n.Component),Ke={deleteLayer:V,closeTextEditor:Z},Ve=Object(a.connect)((function(e){return{context:e.present.data.context,layers:e.present.layers,addons:e.present.data.addons}}),Ke)(Xe),Ze=r("BiHW"),qe=r("6krn"),Je=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Qe=function(){return(Qe=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},$e=function(e,t,r){[p.default.CROP_ASPECT_ORIGINAL,p.default.CROP_ASPECT_FREE].includes(e)&&(e=t/r);var n=t,o=n/e;return o>r&&(n=(o=r)*e),{x:t/2-n/2,y:r/2-o/2,width:n,height:o}},et=function(e){function t(t){var r=e.call(this,t)||this;r.controlMouseDown=function(e,t){e.stopPropagation();var n=r.areaEl.current;if(n){window.addEventListener("mousemove",r.controlMouseMove),window.addEventListener("mouseup",r.controlMouseUp);var o=ie(e.nativeEvent,n),a=o.x,i=o.y;r.shiftX=a,r.shiftY=i,r.initCrop=r.state,r.side=t}},r.controlMouseMove=function(e){var t=r.containerEl.current;if(t){var n=r.state,o=r.props,a=o.artboardWidth,i=o.artboardHeight,s=o.cropAspect,c=s===p.default.CROP_ASPECT_ORIGINAL?a/i:s,l=ie(e,t),u=l.x,d=l.y,f=l.width,_=l.height,h=n.x,g=n.y,m=n.width,v=n.height,E=p.default.CROP_MIN_SIZE,y=p.default.CROP_MIN_SIZE;if(c&&(c>1?E=p.default.CROP_MIN_SIZE*c:c<1&&(y=p.default.CROP_MIN_SIZE/c)),r.side===p.default.CROP_SIDES.CENTER)h=Math.min(Math.max(0,u-r.shiftX),f-m),g=Math.min(Math.max(0,d-r.shiftY),_-v);else{var T=Math.max(0,u-r.shiftX),C=Math.max(0,d-r.shiftY);switch(r.side){case p.default.CROP_SIDES.S:v=d-g-(r.shiftY-r.initCrop.height);break;case p.default.CROP_SIDES.N:v-=(g=C)-n.y;break;case p.default.CROP_SIDES.W:m-=(h=T)-n.x;break;case p.default.CROP_SIDES.E:m=u-h-(r.shiftX-r.initCrop.width);break;case p.default.CROP_SIDES.NW:g=C,m-=(h=T)-n.x,v-=g-n.y;break;case p.default.CROP_SIDES.NE:g=C,m=u-h-(r.shiftX-r.initCrop.width),v-=g-n.y;break;case p.default.CROP_SIDES.SW:m-=(h=T)-n.x,v=d-g-(r.shiftY-r.initCrop.height);break;case p.default.CROP_SIDES.SE:m=u-h-(r.shiftX-r.initCrop.width),v=d-g-(r.shiftY-r.initCrop.height)}if(c){var S=Math.min(m,f-h)/c;if([p.default.CROP_SIDES.NW,p.default.CROP_SIDES.NE].includes(r.side)&&(g=Math.max(0,g+v-S)),_-(g+S)<0)return;v=S}m=Math.min(Math.max(E,m),f-h),v=Math.min(Math.max(y,v),_-g),m-E<=0&&(h=n.x,m=n.width),v-y<=0&&(g=n.y,v=n.height)}r.setState({x:h,y:g,width:m,height:v})}},r.controlMouseUp=function(){window.removeEventListener("mousemove",r.controlMouseMove),window.removeEventListener("mouseup",r.controlMouseUp),delete r.shiftX,delete r.shiftY,delete r.initCrop,delete r.side},r.cropImage=function(){var e=r.state,t=e.width,n=e.height,o=e.x,a=e.y,i=r.props,s=i.currentBackgroundUrl,c=i.artboardWidth,l=i.artboardHeight;r.setState({isButtonDisable:!0});var u=document.createElement("canvas"),p=u.getContext("2d");p&&me.get(s).then((function(e){var i=e.width/c,s=e.height/l;u.width=t*i,u.height=n*s,p.drawImage(e,o*i,a*s,t*i,n*s,0,0,u.width,u.height),u.toBlob((function(e){r.props.setCrop({url:URL.createObjectURL(e),isCropped:!0,data:{artboardWidth:t,originalWidth:u.width,originalHeight:u.height,addons:Qe(Qe({},r.props.addons),{photoHeight:n})},layers:r.props.layers.items.map((function(e){return Qe(Qe({},e),{x:e.x-o,y:e.y-a})})),drawings:r.props.drawings.map((function(e){return Qe(Qe({},e),{path:e.path.map((function(e){return[e[0]-o,e[1]-a]}))})}))}),r.reset(t,n)}),"image/jpeg",1)})).catch((function(e){console.error(e)}))},r.reset=function(e,t){r.props.setAspect(p.default.CROP_ASPECT_FREE),r.setState({x:0,y:0,width:e,height:t,isButtonDisable:!1})},r.containerEl=n.createRef(),r.areaEl=n.createRef();var o=t.cropAspect,a=t.artboardWidth,i=t.artboardHeight;return r.state=Qe({isButtonDisable:!1},$e(o,a,i)),r}return Je(t,e),t.prototype.shouldComponentUpdate=function(e){return e.cropAspect===this.props.cropAspect&&e.artboardWidth===this.props.artboardWidth&&e.artboardHeight===this.props.artboardHeight||this.setState($e(e.cropAspect,e.artboardWidth,e.artboardHeight)),!0},t.prototype.render=function(){var e=this,t=p.default.CROP_SIDES,r=this.props,o=r.artboardWidth,a=r.artboardHeight,i=this.state,s=i.x,c=i.y,l=i.width,u=i.height,d=i.isButtonDisable,f=l<210,_=f?100:60,h=Object(de.classNames)("CropControls__buttons",{"CropControls__buttons--top":c+u+_>=a,"CropControls__buttons--small":f}),g=0!==s||0!==c||l!==o||u!==a;return n.createElement("div",{className:"CropControls",ref:this.containerEl},n.createElement("div",{className:"CropControls__inner",ref:this.areaEl,style:{top:c,left:s,width:l,height:u}},g&&n.createElement("div",{className:h},n.createElement(Ze.default,{size:"s",className:"CropControls__button CropControls__button--cancel",onClick:function(){return e.reset(e.props.artboardWidth,e.props.artboardHeight)}},Object(qe.getLang)("photos_pe_crop_cancel")),n.createElement(Ze.default,{size:"s",className:"CropControls__button",onClick:this.cropImage,disabled:d},Object(qe.getLang)("photos_pe_crop_apply"))),n.createElement("div",{className:"CropControls__grid",onMouseDown:function(r){return e.controlMouseDown(r,t.CENTER)}},n.createElement("div",{className:"CropControls__line CropControls__line--v",style:{left:"33.3333%"}}),n.createElement("div",{className:"CropControls__line CropControls__line--v",style:{left:"66.6666%"}}),n.createElement("div",{className:"CropControls__line CropControls__line--h",style:{top:"33.3333%"}}),n.createElement("div",{className:"CropControls__line CropControls__line--h",style:{top:"66.6666%"}}),n.createElement("div",{className:"CropControls__handleCorner CropControls__handleCorner--nw",onMouseDown:function(r){return e.controlMouseDown(r,t.NW)}}),n.createElement("div",{className:"CropControls__handleCorner CropControls__handleCorner--ne",onMouseDown:function(r){return e.controlMouseDown(r,t.NE)}}),n.createElement("div",{className:"CropControls__handleCorner CropControls__handleCorner--sw",onMouseDown:function(r){return e.controlMouseDown(r,t.SW)}}),n.createElement("div",{className:"CropControls__handleCorner CropControls__handleCorner--se",onMouseDown:function(r){return e.controlMouseDown(r,t.SE)}}),this.props.cropAspect===p.default.CROP_ASPECT_FREE&&n.createElement(n.Fragment,null,n.createElement("div",{className:"CropControls__handle CropControls__handle--n",onMouseDown:function(r){return e.controlMouseDown(r,t.N)}}),n.createElement("div",{className:"CropControls__handle CropControls__handle--s",onMouseDown:function(r){return e.controlMouseDown(r,t.S)}}),n.createElement("div",{className:"CropControls__handle CropControls__handle--w",onMouseDown:function(r){return e.controlMouseDown(r,t.W)}}),n.createElement("div",{className:"CropControls__handle CropControls__handle--e",onMouseDown:function(r){return e.controlMouseDown(r,t.E)}})))))},t}(n.Component),tt={setAspect:$,setCrop:ne},rt=Object(a.connect)((function(e){return{currentBackgroundUrl:f(e),cropAspect:e.present.settings.cropAspect,addons:e.present.data.addons,layers:e.present.layers,drawings:e.present.drawings}}),tt)(et),nt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ot=function(e){function t(t){var r=e.call(this,t)||this;return r.canvasBg=n.createRef(),r}return nt(t,e),t.prototype.componentDidUpdate=function(){this.drawImage()},t.prototype.render=function(){var e=this.props.layer,t=e.width*e.scale,r=e.height*e.scale;return n.createElement("canvas",{ref:this.canvasBg,width:t*p.default.CANVAS_SCALE,height:r*p.default.CANVAS_SCALE,style:{width:t,height:r}})},t.prototype.drawImage=function(){var e=this.props.layer,t=this.canvasBg.current,r=null==t?void 0:t.getContext("2d");if(r){var n=e.width*e.scale,o=e.height*e.scale;r.drawImage(e.canvas,0,0,n*p.default.CANVAS_SCALE,o*p.default.CANVAS_SCALE)}},t}(n.PureComponent),at=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),it=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.controlMouseDown=function(e,r){if(e.preventDefault(),e.stopPropagation(),t.props.startLayerScale(),t.layer=t.props.layer,t.layer.type===p.default.LAYER_TYPES.TEXT){var n=e.target.closest(".EditorLayer__inner");if(!n)return;t.width=n.offsetWidth/t.layer.scale,t.height=n.offsetHeight/t.layer.scale}else t.width=t.layer.width,t.height=t.layer.height;if(void 0!==t.width&&void 0!==t.height){switch(window.addEventListener("mousemove",t.controlMouseMove),window.addEventListener("mouseup",t.controlMouseUp),r){case"se":t.offsetFromCenter={x:t.width/2,y:t.height/2};break;case"sw":t.offsetFromCenter={x:-t.width/2,y:t.height/2};break;case"ne":t.offsetFromCenter={x:t.width/2,y:-t.height/2};break;case"nw":t.offsetFromCenter={x:-t.width/2,y:-t.height/2}}void 0!==t.offsetFromCenter&&(t.distanceToZero=Math.sqrt(t.offsetFromCenter.x*t.offsetFromCenter.x+t.offsetFromCenter.y*t.offsetFromCenter.y))}},t.controlMouseMove=function(e){var r=ie(e,document.querySelector(".EditorCanvas__canvas--draw")),n=r.x,o=r.y;if(void 0!==t.offsetFromCenter&&void 0!==t.distanceToZero&&void 0!==t.width&&void 0!==t.height){var a={x:n-t.layer.x,y:o-t.layer.y},i=180*(Math.atan2(a.y,a.x)-Math.atan2(t.offsetFromCenter.y,t.offsetFromCenter.x))/Math.PI,s=Math.max(p.default.LAYER_MIN_SIZE,Math.sqrt(a.x*a.x+a.y*a.y))/t.distanceToZero;t.props.setLayerScale(s,i)}},t.controlMouseUp=function(){window.removeEventListener("mousemove",t.controlMouseMove),window.removeEventListener("mouseup",t.controlMouseUp),delete t.width,delete t.height,delete t.centerCoordinates,delete t.offsetFromCenter,delete t.distanceToZero},t}return at(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"EditorLayerSelection"},n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--nw",onMouseDown:function(t){return e.controlMouseDown(t,"nw")}}),n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--ne",onMouseDown:function(t){return e.controlMouseDown(t,"ne")}}),n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--sw",onMouseDown:function(t){return e.controlMouseDown(t,"sw")}}),n.createElement("div",{className:"EditorLayerSelection__handler EditorLayerSelection__handler--se",onMouseDown:function(t){return e.controlMouseDown(t,"se")}}))},t}(n.Component),st=r("Xrg9"),ct=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),lt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ct(t,e),t.prototype.render=function(){return st.default.get("story_show_clickable_zones")?this.props.clickableZones.map((function(e,t){var r=e.clickable_area,o=100*Math.abs(r[1].x-r[0].x),a=100*Math.abs(r[2].y-r[1].y);return n.createElement("div",{key:t,className:"EditorClickableZone",style:{top:100*r[0].y+"%",left:100*r[0].x+"%",width:o+"%",height:a+"%"}})})):null},t}(n.Component),ut=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),pt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleDoubleClick=function(){t.props.toggleTextEditor(!0)},t}return ut(t,e),t.prototype.render=function(){var e=this.props,t=e.layer,r=e.currentIndex,n=e.index,o=null,a=Object(de.classNames)("EditorLayer","EditorLayer--"+t.type,{"EditorLayer--active":r===n,"EditorLayer--locked":t.locked});switch(t.type){case p.default.LAYER_TYPES.STICKER:o=this.renderLayerSticker(t,n,a);break;case p.default.LAYER_TYPES.TEXT:o=this.renderLayerText(t,n,a);break;case p.default.LAYER_TYPES.IMAGE:o=this.renderLayerImage(t,n,a);break;case p.default.LAYER_TYPES.BACKGROUND:o=this.renderLayerBackground(t,n,a)}if(t.isBackground){var i=document.querySelector(".EditorCanvas__layers--bg");return i?oe.createPortal(o,i):null}return o},t.prototype.renderLayerBackground=function(e,t,r){return n.createElement("div",{key:t,className:r,"data-index":t,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner"},n.createElement(ot,{layer:e}),this.props.currentIndex===t&&n.createElement(it,{layer:e,setLayerScale:this.props.setLayerScale,startLayerScale:this.props.startLayerScale})))},t.prototype.renderLayerSticker=function(e,t,r){var o=this.props.getStickerUrlById(e.id,p.default.STICKER_LARGE);return n.createElement("div",{key:t,className:r,"data-index":t,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner",style:{width:e.width*e.scale,height:e.height*e.scale,backgroundImage:"url('"+o+"')"}},this.props.currentIndex===t&&n.createElement(it,{layer:e,setLayerScale:this.props.setLayerScale,startLayerScale:this.props.startLayerScale})))},t.prototype.renderLayerImage=function(e,t,r){return n.createElement("div",{key:t,className:r,"data-index":t,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner",style:{width:e.width*e.scale,height:e.height*e.scale,backgroundImage:"url('"+e.url+"')"}},this.props.currentIndex===t&&n.createElement(it,{layer:e,setLayerScale:this.props.setLayerScale,startLayerScale:this.props.startLayerScale}),e.clickableZones&&n.createElement(lt,{clickableZones:e.clickableZones})))},t.prototype.renderLayerText=function(e,t,r){var o=Math.max(10,e.fontSize*p.default.FONT_SIZE_COEFFICIENT);r+=" PhotoEditorFontStyle--"+e.fontStyle;var a={fontSize:o*e.scale,color:e.color};return this.props.currentIndex===t&&e.isEdit?null:n.createElement("div",{key:t,className:r,"data-index":t,style:{width:1,height:1,transform:"translate("+e.x+"px, "+e.y+"px) rotateZ("+e.rotate+"deg)"}},n.createElement("div",{className:"EditorLayer__inner",style:a,onDoubleClick:this.handleDoubleClick},n.createElement("div",null,Object(H.decodeHTMLEntities)(e.text.replace(/(\v)/gm,"\n"))),this.props.currentIndex===t&&n.createElement(it,{layer:e,setLayerScale:this.props.setLayerScale,startLayerScale:this.props.startLayerScale})))},t}(n.Component),dt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ft=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return dt(t,e),t.prototype.render=function(){var e=this,t=this.props.layers,r=t.items,o=t.currentIndex,a=Object(de.classNames)("EditorCanvas__layers",{"EditorCanvas__layers--disabled":[p.default.TABS.PAINT,p.default.TABS.FILTERS,p.default.TABS.COLOR,p.default.TABS.CROP].includes(this.props.currentMode)});return n.createElement(n.Fragment,null,n.createElement("div",{className:a+" EditorCanvas__layers--items"},r.map((function(t,r){return n.createElement(pt,{key:r,index:r,currentIndex:o,layer:t,setLayerScale:e.props.setLayerScale,startLayerScale:e.props.startLayerScale,toggleTextEditor:e.props.toggleTextEditor,getStickerUrlById:e.props.getStickerUrlById})}))),n.createElement("div",{className:a+" EditorCanvas__layers--bg"}))},t}(n.Component),_t=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ht=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){var e=r.textareaEl.current;e&&(r.onChange(),e.select())},r.render=function(){var e=r.props.layer,t=Math.max(10,e.fontSize*p.default.FONT_SIZE_COEFFICIENT);return e.initialFontSize&&(t=e.initialFontSize*p.default.FONT_SIZE_COEFFICIENT),n.createElement("div",{className:"EditorText"},n.createElement("div",{className:"EditorText__inner"},n.createElement("textarea",{ref:r.textareaEl,className:"EditorText__textarea PhotoEditorFontStyle--"+e.fontStyle,defaultValue:Object(H.decodeHTMLEntities)(e.text).replace(/(\v)/gm,""),autoFocus:!0,onKeyDown:r.onKeyDown,onChange:r.onChange,onInput:r.onChange,onPaste:r.onChange,style:{color:e.color,fontSize:t,height:r.state.height}})))},r.onKeyDown=function(e){if("Enter"===e.key)if(e.preventDefault(),e.stopPropagation(),e.ctrlKey||e.metaKey||e.shiftKey){var t=r.textareaEl.current;if(t){var n=e.target.selectionStart,o=e.target.selectionEnd;t.value=t.value.substring(0,n)+"\n"+t.value.substring(o),t.selectionStart=t.selectionEnd=n+1,r.onChange()}}else r.props.closeTextEditor()},r.onChange=function(){var e=r.textareaEl.current;e&&(r.setState({height:0},(function(){r.setState({height:e.scrollHeight})})),r.props.onChange(r.applyLineBreaks(e)))},r.applyLineBreaks=function(e){var t=e.value,r=e.cloneNode(!0);document.querySelector(".EditorText__inner").appendChild(r),r.setAttribute("wrap","off"),r.value="";for(var n=r.scrollWidth,o=0,a=-1;o<t.length;o++){var i=t.charAt(o);if(" "!=i&&"-"!=i&&"+"!=i||(a=o),r.value+=i,r.scrollWidth>n){var s="";if(a>=0){for(var c=a+1;c<o;c++)s+=t.charAt(c);a=-1}s+=i,r.value=r.value.substr(0,r.value.length-s.length),r.value+="\n\v"+s}}return r.remove(),r.value.replace(/(\n\v)/gm,"\v")},r.state={height:0},r.textareaEl=n.createRef(),Object(j.sendStat)(j.EVENTS.EDIT_TEXT),r}return _t(t,e),t.prototype.componentDidUpdate=function(e){e.layer.fontSize===this.props.layer.fontSize&&e.layer.fontStyle===this.props.layer.fontStyle||this.onChange()},t}(n.Component),gt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),mt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.setMode=function(e){e===p.default.BACKGROUND_MODES.PHOTO?Object(j.sendStat)(j.EVENTS.CLICK_TO_CAMERA_ICON):e===p.default.BACKGROUND_MODES.BACKGROUND&&Object(j.sendStat)(j.EVENTS.CLICK_TO_GRADIENT_ICON),t.props.setMode(e)},t}return gt(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"SwitchMode"},Object.values(p.default.BACKGROUND_MODES).map((function(t){var r=Object(de.classNames)("SwitchMode__mode","SwitchMode__mode--"+t,{"SwitchMode__mode--active":t===e.props.current});return n.createElement("span",{key:t,className:r,onClick:function(){return e.setMode(t)}})})))},t}(n.PureComponent),vt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Et=function(e){function t(t){var r=e.call(this,t)||this;return r.state={onHover:!1},r}return vt(t,e),t.prototype.render=function(){var e=this,r=Object(de.classNames)("DropBox",{"DropBox--hover":this.state.onHover});return n.createElement("div",{className:r,onMouseOver:function(){return e.setState({onHover:!0})},onMouseOut:function(){return e.setState({onHover:!1})},onMouseUp:this.props.onDelete},t.renderIcon())},t.renderIcon=function(){return n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"50",height:"50",fill:"none"},n.createElement("path",{fill:"#fff",d:"M17.5 18.38a1 1 0 00-2 .24l1.8 15.23a3 3 0 002.98 2.65h9.44a3 3 0 002.98-2.65l1.8-15.23a1 1 0 10-2-.24l-1.78 15.24a1 1 0 01-1 .88h-9.44a1 1 0 01-1-.88L17.5 18.38z"}),n.createElement("path",{fill:"#fff",d:"M22 21.45a1 1 0 00-2 .1l.5 10a1 1 0 102-.1l-.5-10zm8 .1a1 1 0 00-2-.1l-.5 10a1 1 0 102 .1l.5-10zm-4-.05a1 1 0 10-2 0v10a1 1 0 002 0v-10z"}),n.createElement("path",{fill:"#fff",fillRule:"evenodd",d:"M20.62 16.5c.08-.35.2-.77.42-1.2.32-.64.8-1.19 1.38-1.59A4.55 4.55 0 0125 13c1.05 0 1.9.27 2.58.71.59.4 1.06.95 1.38 1.6.21.42.34.84.42 1.19H36a1 1 0 010 2H14a1 1 0 010-2h6.63zm6.68 0a2.9 2.9 0 00-.13-.3c-.16-.33-.4-.61-.7-.82-.31-.2-.77-.38-1.47-.38s-1.16.17-1.47.38c-.32.2-.54.5-.7.82-.05.1-.1.2-.13.3h4.6z",className:"DropBox__cap",clipRule:"evenodd"}))},t}(n.PureComponent),yt=r("s0Wt"),Tt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Ct=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render=function(){var e=t.props.data.artboardContainer;return e?oe.createPortal(t.renderCanvas(),e):t.renderCanvas()},t.renderCanvas=function(){var e=t.props,r=e.layers,o=e.background,a=e.data,i=e.ui,s=e.settings,c=a.addons,l=a.artboardWidth,u=a.artboardHeight,d=a.attachment,f=t.props.layers,_=f.currentIndex,h=f.items,g=null!==_&&h[_],m=g&&g.type===p.default.LAYER_TYPES.TEXT&&g.isEdit,v=t.props.ui.isDataLoaded&&t.props.data.context===p.default.CONTEXT_TYPES.STORY,E=t.props.marginTop,y=u;c&&c.photoHeight&&(y=c.photoHeight);var T=Object(de.classNames)("EditorCanvas",{"EditorCanvas--blurCursor":p.default.TABS.COLOR===i.currentMode&&s.blur.isEnabled}),C=Object(de.classNames)("EditorCanvas__scaleButton",{"EditorCanvas__scaleButton--enabled":!r.items[0].locked});return n.createElement(n.Fragment,null,n.createElement("div",{style:{width:l,height:y,marginTop:E},className:T},t.props.ui.isDataLoaded&&i.currentMode===p.default.TABS.CROP&&n.createElement(rt,{artboardWidth:l,artboardHeight:y}),n.createElement(ft,{setLayerScale:t.props.setLayerScale,startLayerScale:t.props.startLayerScale,toggleTextEditor:t.props.toggleTextEditor,currentMode:t.props.ui.currentMode,getStickerUrlById:t.props.getStickerUrlById,layers:r}),m&&g?n.createElement(ht,{layer:g,onChange:t.onChangeText,closeTextEditor:t.props.closeTextEditor}):v&&n.createElement(n.Fragment,null,!!d&&!i.isShowDropBox&&n.createElement(yt.default,{text:Object(qe.getLang)("photos_pe_attached_post"),position:"b",marginTop:5,align:"left"},n.createElement("span",{className:"EditorCanvas__postIcon"})),!i.isShowDropBox&&t.props.background.currentBackgroundType===p.default.BACKGROUND_MODES.PHOTO&&[p.default.TABS.STICKERS,p.default.TABS.TEXT].includes(t.props.ui.currentMode)&&n.createElement("button",{className:C,onClick:t.onClickScaleButton}),!i.isShowDropBox&&n.createElement(mt,{current:o.currentBackgroundType,setMode:t.props.setMode})),i.isShowDropBox&&g&&g.canDelete&&n.createElement(Et,{onDelete:t.props.deleteLayer}),t.props.ui.isDataLoaded&&n.createElement(ge,{width:l,height:y}),t.props.ui.isDataLoaded&&n.createElement(Ye,{width:l,height:y})),t.props.ui.isDataLoaded&&n.createElement(Ve,{currentBackgroundId:o.currentBackgroundId,setCurrentBackgroundId:t.props.setCurrentBackgroundId,currentBackgroundType:o.currentBackgroundType,uploadPhoto:t.props.uploadPhoto,backgrounds:t.props.data.backgrounds}))},t.onClickScaleButton=function(){var e,r,n=t.props.layers.items[0],o={},a=t.props.data,i=a.artboardWidth,s=a.artboardHeight,c=n.height/n.width;c>1.77?e=(r=s)/c:(e=i,r=i*c);var l=i/2,u=s/2;n.locked?(Object(j.sendStat)(j.EVENTS.ZOOM),Object.assign(o,{locked:!1,scale:.7})):(Object(j.sendStat)(j.EVENTS.UNZOOM),Object.assign(o,{locked:!0,rotate:0,x:l,y:u,width:e,height:r,scale:1})),t.props.updateBackgroundLayer(o),t.props.setCurrentLayer(n.locked?0:null)},t.onChangeText=function(e){t.props.setLayerText(e)},t}return Tt(t,e),t}(n.Component),St={setCurrentBackgroundId:function(e){return Object(j.sendStat)(j.EVENTS.SELECT_BACKGROUND),{type:"SET_CURRENT_BACKGROUND_ID",value:e}},setLayerScale:function(e,t){return function(r,n){var o=n().present.layers,a=o.currentIndex,i=o.items;null!==a&&i[a]&&r({type:"SET_LAYER_SCALE",payload:{scale:e,rotate:t}})}},startLayerScale:function(){return{type:"START_LAYER_SCALE"}},setLayerText:function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,a=n.items;null!==o&&a[o]&&t({type:"SET_LAYER_TEXT",payload:{text:e}})}},toggleTextEditor:X,deleteLayer:V,updateBackgroundLayer:K,setCurrentLayer:G,setBackgroundType:ee,closeTextEditor:Z},bt=Object(a.connect)((function(e){return{ui:e.present.ui,settings:e.present.settings,layers:e.present.layers,drawings:e.present.drawings,background:e.present.background,data:e.present.data,marginTop:_(e)}}),St)(Ct),wt=r("JxXo"),Ot=r("x9XA"),xt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Pt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onTabClick=function(e,r){r||t.props.change(e)},t}return xt(t,e),t.prototype.render=function(){var e=this,t=this.props.current;return n.createElement("div",{className:"EditorTabs"},n.createElement("div",{className:"EditorTabs__header"},n.Children.map(this.props.children,(function(r){if(r){var o=r.props["data-disabled"],a=Object(de.classNames)("EditorTabs__item","EditorTabs__item--"+r.props["data-mode"],{"EditorTabs__item--current":t===r.props["data-mode"],"EditorTabs__item--disabled":o}),i=n.createElement("div",{className:a,key:r.props["data-mode"],onClick:function(){return e.onTabClick(r.props["data-mode"],o)}});if(o){var s=n.createElement("div",{className:"EditorTabsTooltip"},n.createElement("span",{className:"EditorTabsTooltip__text"},Object(qe.getLang)("photos_pe_filters_disabled_text")),n.createElement(Ot.default,{onClick:function(){return e.props.setMode(p.default.BACKGROUND_MODES.PHOTO)},className:"EditorTabsTooltip__link"},Object(qe.getLang)("photos_pe_filters_disabled_button")));return n.createElement(wt.default,{className:"EditorTabs__tooltip",text:s,appearance:"light",position:"b",maxWidth:203},i)}return i}}))),n.createElement("div",{className:"EditorTabs__content"},n.Children.map(this.props.children,(function(e){if(e){var r={className:Object(de.classNames)(e.props.className,"EditorTabs__tab",{"EditorTabs__tab--current":t===e.props["data-mode"]})};return n.cloneElement(e,r)}}))))},t}(n.Component),At=r("URsI"),Rt=r("EasH"),Lt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Nt=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){r.fetchStickers()},r.componentDidUpdate=function(){r.scrollWithAnimation=!1},r.render=function(){var e=r.props,t=e.stickers,o=e.stickerMouseDown,a=r.props.ui,i=a.stickerHeaderScrollPosition,s=a.currentStickerPackIndex,c=r.scrollElement.current,l=!!i,u=!1,d=0;c&&(d=i+c.offsetWidth,u=!!(c.scrollWidth-d));var f=t[s]?t[s].items:[];r.needReset&&(r.needReset=!1,f=[],r.setState({}));for(var _=[],h=0,g=f.length;h<g;h+=3)_.push(f.slice(h,h+3));return n.createElement("div",{className:"StickersPanel"},n.createElement("div",{className:"StickersPanel__header"},n.createElement("div",{className:"StickersPanel__scroll",style:{transform:"translateX(-"+i+"px)",transition:r.scrollWithAnimation?"transform .3s ease-out":""},ref:r.scrollElement,onWheel:r.tabsMouseWheel},n.createElement("div",{className:"StickersPanel__tab StickersPanel__tab--store",onClick:function(){return r.showStickerShop()}}),t.map((function(e,t){var o=e.id,a=r.getTabPreviewUrl(t);if(!a)return null;var i=!Object(Oe.inArray)(o,["recent","editor"]),c=Object(de.classNames)("StickersPanel__tab",{"StickersPanel__tab--selected":t===s,"StickersPanel__tab--recent":"recent"===o,"StickersPanel__tab--editor":"editor"===o});return n.createElement("div",{key:o,className:c,style:i?{backgroundImage:"url('"+a+"')"}:void 0,onClick:function(){return r.selectStickerPack(t)}})}))),l&&n.createElement("div",{className:"StickersPanel__arrow StickersPanel__arrow--left",onClick:function(){return r.handleTabArrowClick(!0)}},n.createElement("span",{className:"StickersPanel__arrowIcon"})),u&&n.createElement("div",{className:"StickersPanel__arrow StickersPanel__arrow--right",onClick:function(){return r.handleTabArrowClick(!1)}},n.createElement("span",{className:"StickersPanel__arrowIcon"}))),n.createElement(At.default,{virtualized:!0,loadMore:function(){},hasMore:!1,className:"StickersPanel__content",itemHeight:98},_.map((function(e,t){return n.createElement("div",{key:t,className:"StickersPanel__row"},e.map((function(e){var t=e.id,r=e.sizes;return n.createElement("div",{key:t,className:"StickersPanel__preview",onMouseDown:function(e){return o(e,t)}},n.createElement("img",{src:r[p.default.STICKER_MEDIUM],className:"StickersPanel__previewImage"}))})))}))))},r.getTabPreviewUrl=function(e){var t=r.props.stickers[e].items,n=(t||[])[0],o=void 0===n?null:n;return!(!t||!o)&&o.sizes[p.default.STICKER_THUMB]},r.selectStickerPack=function(e){r.needReset=!0,r.props.setCurrentStickerPackIndex(e)},r.tabsMouseWheel=function(e){r.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},r.handleTabArrowClick=function(e){var t=r.scrollElement.current;if(t){var n=t.offsetWidth;e&&(n=-n),r.setPosition(n,!0)}},r.setPosition=function(e,t){var n=r.scrollElement.current,o=r.props.ui.stickerHeaderScrollPosition;if(n){var a=n.offsetWidth,i=Math.max(0,Math.min(o+e,n.scrollWidth-a));t&&(r.scrollWithAnimation=!0),r.props.setHeaderScrollPosition(i)}},r.loadingLimit=25,r.scrollElement=n.createRef(),r.scrollWithAnimation=!1,r.needReset=!1,r}return Lt(t,e),t.prototype.fetchStickers=function(){var e=this;window.ajax.post("al_photos.php",{act:"get_editor_data"},{onDone:function(t){var r={};t.stickers.forEach((function(e){e.items.forEach((function(e){r[e.id]=e}))})),e.props.setData({stickers:t.stickers,stickersMap:r})},onFail:function(e){return console.error(e),!0}})},t.prototype.showStickerShop=function(){var e=this;Object(Rt.showBox)("al_im.php",{act:"stickers_store",box:1},{dark:1,stat:["im.css","imn.js","page_help.css",window.jsc("web/sorter.js")],params:{onDestroy:function(){e.fetchStickers()}}})},t}(n.Component),It={setCurrentStickerPackIndex:function(e){return{type:"SET_CURRENT_STICKER_PACK_INDEX",value:e}},setHeaderScrollPosition:function(e){return{type:"SET_HEADER_SCROLL_POSITION",value:e}},setData:re},Dt=Object(a.connect)((function(e){return{ui:e.present.ui,stickers:e.present.data.stickers}}),It)(Nt),kt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Bt=function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)n[o]=a[i];return n},Mt=function(e){function t(t){var r=e.call(this,t)||this;return r.colors=r.getColors(t.avgColor),r}return kt(t,e),t.prototype.shouldComponentUpdate=function(e){return JSON.stringify(e.avgColor)!==JSON.stringify(this.props.avgColor)&&(this.colors=this.getColors(e.avgColor)),!0},t.prototype.render=function(){var e=this;return n.createElement("div",{className:"ColorPicker"},this.colors.map((function(t,r){var o=Object(de.classNames)("ColorPicker__color",{"ColorPicker__color--white":"#FFFFFF"===t,"ColorPicker__color--selected":t===e.props.color});return n.createElement("div",{key:r,className:o,style:{backgroundColor:t},onClick:function(){return e.props.setColor(t)}})})))},t.prototype.getColors=function(e){var t,r=function(e,t,r){var n=0,o=0,a=e/255,i=t/255,s=r/255,c=Math.max(a,i,s),l=c-Math.min(a,i,s),u=function(e){return(c-e)/6/l+.5},p=function(e){return Math.round(100*e)/100};if(0!==l){o=l/c;var d=u(a),f=u(i),_=u(s);a===c?n=_-f:i===c?n=1/3+d-_:s===c&&(n=2/3+f-d),n<0?n+=1:n>1&&(n-=1)}return{h:Math.round(360*n),s:p(100*o),v:p(100*c)}}(e.r,e.g,e.b),n=[];return p.default.AVERAGE_COLORS_MAP.forEach((function(e){var t=Math.round(Math.min(Math.max(r.s+e.s,0),100)),o=Math.round(Math.min(Math.max(r.v+e.v,0),100));n.push(function(e,t,r){t/=100,r/=100;var n=(1-Math.abs(2*r-1))*t,o=n*(1-Math.abs(e/60%2-1)),a=r-n/2,i=0,s=0,c=0;return 0<=e&&e<60?(i=n,s=o,c=0):60<=e&&e<120?(i=o,s=n,c=0):120<=e&&e<180?(i=0,s=n,c=o):180<=e&&e<240?(i=0,s=o,c=n):240<=e&&e<300?(i=o,s=0,c=n):300<=e&&e<360&&(i=n,s=0,c=o),i=Math.round(255*(i+a)).toString(16),s=Math.round(255*(s+a)).toString(16),c=Math.round(255*(c+a)).toString(16),1==i.length&&(i="0"+i),1==s.length&&(s="0"+s),1==c.length&&(c="0"+c),"#"+i+s+c}(r.h,t,o).toUpperCase())})),(t=Bt(p.default.COLORS,n),t.filter((function(e,t,r){return r.indexOf(e)==t}))).slice(0,30)},t}(n.Component),Ft=r("eP0d"),Ut=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),jt=function(e){function t(t){var r=e.call(this,t)||this;return r.componentDidMount=function(){r.updateDrawingPreview()},r.render=function(){var e=r.props,t=e.settings,o=e.setColor,a=e.setBrushWidth,i=e.setBrushOpacity,s=e.avgColor;return r.updateDrawingPreview(),n.createElement("div",{className:"DrawPanel"},n.createElement("canvas",{ref:r.previewCanvas,className:"DrawPanel__preview",width:p.default.DRAWING_PREVIEW_WIDTH*p.default.CANVAS_SCALE,height:p.default.DRAWING_PREVIEW_HEIGHT*p.default.CANVAS_SCALE,style:{width:p.default.DRAWING_PREVIEW_WIDTH,height:p.default.DRAWING_PREVIEW_HEIGHT}}),n.createElement("div",{className:"DrawPanel__sliders"},n.createElement("div",{className:"DrawPanel__slider"},n.createElement("div",{className:"DrawPanel__title"},Object(qe.getLang)("photos_pe_intensity")),n.createElement(Ft.default,{min:0,max:1,isShowHandle:!0,defaultValue:t.brushOpacity,formatHint:function(e){return Math.round(100*e)+"%"},onChange:function(e){return i(e)}})),n.createElement("div",{className:"DrawPanel__slider"},n.createElement("div",{className:"DrawPanel__title"},Object(qe.getLang)("photos_pe_line_width")),n.createElement(Ft.default,{min:0,max:1,isShowHandle:!0,defaultValue:t.brushWidth,formatHint:function(e){return Math.round(100*e)+"%"},onChange:function(e){return a(e)}}))),n.createElement("div",{className:"DrawPanel__colors"},n.createElement("div",{className:"DrawPanel__title DrawPanel__title--largeOffset"},Object(qe.getLang)("photos_pe_color")),n.createElement(Mt,{color:t.color,avgColor:s,setColor:o})))},r.updateDrawingPreview=function(){var e=r.previewCanvas.current,t=r.props.settings;if(e){var n=e.getContext("2d");if(n){var o=n.canvas,a=o.width,i=o.height;n.clearRect(0,0,a,i);var s=p.default.CANVAS_SCALE,c=new Path2D("M"+69*s+" "+65*s+"L"+93*s+" "+41*s+"L"+121*s+" "+69*s+"L"+149*s+" "+41*s+"L"+177*s+" "+69*s+"L"+201*s+" "+45*s),l="#FFFFFF"===t.color?"#F1F1F1":t.color;n.lineWidth=t.brushWidth*p.default.BRUSH_WIDTH_COEFFICIENT*s,n.strokeStyle=se(l,t.brushOpacity),n.lineJoin=n.lineCap="round",n.stroke(c)}}},r.previewCanvas=n.createRef(),r}return Ut(t,e),t}(n.Component),Ht={setColor:Q,setBrushWidth:function(e){return{type:"SET_SETTING_BRUSH_WIDTH",brushWidth:Math.max(.1,e)}},setBrushOpacity:function(e){return{type:"SET_SETTING_BRUSH_OPACITY",brushOpacity:e}}},Yt=Object(a.connect)((function(e){return{settings:e.present.settings,drawings:e.present.drawings,avgColor:e.present.layers.items[0].avgColor}}),Ht)(jt),Gt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Wt=function(){return(Wt=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},zt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.flip=function(e,r){var n=document.createElement("canvas"),o=null==n?void 0:n.getContext("2d"),a=t.props.currentBackgroundUrl;o&&me.get(a).then((function(a){n.width=a.width,n.height=a.height,e?(o.translate(n.width,0),o.scale(-1,1)):r&&(o.translate(0,n.height),o.scale(1,-1)),o.drawImage(a,0,0),n.toBlob((function(n){var o={url:URL.createObjectURL(n)};e&&(o.flipX=!t.props.flipX),r&&(o.flipY=!t.props.flipY),t.props.setCrop(o)}),"image/jpeg",1)})).catch((function(e){console.error(e)}))},t.rotate=function(e){var r=document.createElement("canvas"),n=null==r?void 0:r.getContext("2d"),o=t.props,a=o.currentBackgroundUrl,i=o.originalWidth,s=o.originalHeight;n&&me.get(a).then((function(o){r.width=o.height,r.height=o.width;var a=e?-90:90;n.translate(r.width/2,r.height/2),n.rotate(a*Math.PI/180),n.drawImage(o,-o.width/2,-o.height/2),r.toBlob((function(e){var n=r.height/r.width,o=t.props.rotate+a;t.props.rotate>o?Object(j.sendStat)(j.EVENTS.TURN_LEFT):Object(j.sendStat)(j.EVENTS.TURN_RIGHT);var c,l,u=document.getElementById("pv_photo").getBoundingClientRect(),d=u.width,f=u.height;f-=p.default.BOTTOM_PANEL_HEIGHT,n>=.67?(c=f/n,l=f):(c=d,l=d*n),t.props.setCrop({url:URL.createObjectURL(e),data:{artboardWidth:c,originalWidth:s,originalHeight:i,addons:Wt(Wt({},t.props.addons),{photoHeight:l})},rotate:o>270?0:o})}),"image/jpeg",1)})).catch((function(e){console.error(e)}))},t}return Gt(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"CropPanel"},n.createElement("span",{className:"CropPanel__title"},Object(qe.getLang)("photos_pe_crop_aspect_title")),n.createElement("ul",{className:"CropPanelRatioTabs"},p.default.CROP_ASPECTS.map((function(t){var r=Object(de.classNames)("CropPanelRatioTabs__button",{"CropPanelRatioTabs__button--active":e.props.cropAspect===t.value});return n.createElement("li",{className:"CropPanelRatioTabs__item",key:t.title},n.createElement("button",{className:r,onClick:function(){return e.props.setAspect(t.value)}},Object(qe.getLang)(t.title)))}))),n.createElement("ul",{className:"CropPanelSettings"},n.createElement("li",{className:"CropPanelSettings__item"},n.createElement(Ot.default,{className:"CropPanelSettings__link CropPanelSettings__link--rotateRight",onClick:function(){return e.rotate(!1)}},Object(qe.getLang)("photos_pe_rotate_right"))),n.createElement("li",{className:"CropPanelSettings__item"},n.createElement(Ot.default,{className:"CropPanelSettings__link CropPanelSettings__link--rotateLeft",onClick:function(){return e.rotate(!0)}},Object(qe.getLang)("photos_pe_rotate_left"))),n.createElement("li",{className:"CropPanelSettings__item"},n.createElement(Ot.default,{className:"CropPanelSettings__link CropPanelSettings__link--flipHorizontal",onClick:function(){return e.flip(!0,!1)}},Object(qe.getLang)("photos_pe_flip_horizontal"))),n.createElement("li",{className:"CropPanelSettings__item"},n.createElement(Ot.default,{className:"CropPanelSettings__link CropPanelSettings__link--flipVertical",onClick:function(){return e.flip(!1,!0)}},Object(qe.getLang)("photos_pe_flip_vertical")))))},t}(n.Component),Xt={setCrop:ne,setAspect:$},Kt=Object(a.connect)((function(e){return{flipX:e.present.settings.flipX,flipY:e.present.settings.flipY,rotate:e.present.settings.rotation,cropAspect:e.present.settings.cropAspect,currentBackgroundUrl:f(e),addons:e.present.data.addons,artboardWidth:e.present.data.artboardWidth,artboardHeight:e.present.data.artboardHeight,originalWidth:e.present.data.originalWidth,originalHeight:e.present.data.originalHeight}}),Xt)(zt),Vt=r("W8yn"),Zt=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),qt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.render=function(){var e=t.props,r=e.settings,o=e.setColor,a=e.setFontSize,i=e.layer,s=e.fontsPlaceholders,c=e.avgColor,l=i&&i.isEdit,u=i&&i.fontStyle,d=i&&i.fontSize,f=i&&i.color;return n.createElement("div",{className:"TextPanel"},l?n.createElement(Ze.default,{className:"TextPanelButton",onClick:t.props.closeTextEditor},Object(Ge.getLang)("photos_pe_save_text")):n.createElement(Ze.default,{className:"TextPanelButton",onClick:function(){return t.props.addLayerText(!0,{isEdit:!0})}},n.createElement("div",{className:"TextPanelButton__icon"}),Object(Ge.getLang)("photos_pe_add_text")),n.createElement("div",{className:"TextPanelButton__fonts"},n.createElement("div",{className:"TextPanelButton__title"},Object(Ge.getLang)("photos_pe_font")),p.default.FONTS.map((function(e,o){return n.createElement(Vt.default,{key:e,value:e,name:"photo_editor_fonts",className:"TextPanelButton__radio",onChange:function(){return t.props.setFontStyle(e)},checked:u?u===e:r.fontStyle===e},n.createElement("span",{className:"TextPanelButton__font TextPanelButton__font--"+e+" PhotoEditorFontStyle--"+e},s[o]))}))),n.createElement("div",{className:"TextPanelButton__fontSize"},n.createElement("div",{className:"TextPanelButton__title"},Object(Ge.getLang)("photos_pe_font_size")),n.createElement(Ft.default,{min:0,max:1,isShowHandle:!0,value:d||r.fontSize,formatHint:function(e){return""+Math.round(100*e)},onChange:function(e){return a(e)}})),n.createElement("div",{className:"TextPanelButton__colors"},n.createElement("div",{className:"TextPanelButton__title"},Object(Ge.getLang)("photos_pe_color")),n.createElement(Mt,{color:f||r.color,avgColor:c,setColor:o})))},t}return Zt(t,e),t}(n.Component),Jt={addLayerText:z,setColor:Q,setFontSize:function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,a=n.items;o&&!a[o]||t(function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,a=n.items;null!==o&&a[o]&&t({type:y,payload:{fontSize:e}})}}(e)),t({type:"SET_SETTING_FONT_SIZE",fontSize:e})}},setFontStyle:function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,a=n.items;o&&!a[o]||t(function(e){return function(t,r){var n=r().present.layers,o=n.currentIndex,a=n.items;null!==o&&a[o]&&t({type:"SET_LAYER_FONT_STYLE",payload:{fontStyle:e}})}}(e)),t({type:"SET_SETTING_FONT_FAMILY",fontStyle:e})}},closeTextEditor:Z},Qt=Object(a.connect)((function(e){var t=e.present.layers,r=t.items,n=t.currentIndex,o=null;return null!==n&&(o=r[n]),{settings:e.present.settings,layer:o,fontsPlaceholders:e.present.data.fontsPlaceholders,avgColor:e.present.layers.items[0].avgColor}}),Jt)(qt),$t=r("hN/p"),er=r("85vT"),tr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),rr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return tr(t,e),t.prototype.render=function(){var e=this.props,t=e.settings,r=e.setColorCorrection;return n.createElement("div",{className:"ColorPanel"},n.createElement("div",{className:"ColorPanel__items"},n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object(qe.getLang)("photos_pe_correction_exposure")),n.createElement(Ft.default,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.exposure,onChange:function(e){return r("exposure",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object(qe.getLang)("photos_pe_correction_contrast")),n.createElement(Ft.default,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.contrast,onChange:function(e){return r("contrast",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object(qe.getLang)("photos_pe_correction_saturation")),n.createElement(Ft.default,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.saturation,onChange:function(e){return r("saturation",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object(qe.getLang)("photos_pe_correction_warmth")),n.createElement(Ft.default,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.warmth,onChange:function(e){return r("warmth",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object(qe.getLang)("photos_pe_correction_vignette")),n.createElement(Ft.default,{min:-1,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.vignette,onChange:function(e){return r("vignette",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object(qe.getLang)("photos_pe_correction_sharpness")),n.createElement(Ft.default,{min:0,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.sharpness,onChange:function(e){return r("sharpness",e)},formatHint:function(e){return Math.round(100*e)}})),n.createElement("div",{className:"ColorPanel__item"},n.createElement("span",{className:"ColorPanel__name"},Object(qe.getLang)("photos_pe_correction_grain")),n.createElement(Ft.default,{min:0,max:1,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.colorCorrection.grain,onChange:function(e){return r("grain",e)},formatHint:function(e){return Math.round(100*e)}}))),n.createElement("div",{className:"ColorPanel__linkBox"},this.renderAutoCorrectionPanel()),n.createElement("div",{className:"ColorPanel__linkBox"},this.renderBlurPanel()))},t.prototype.renderAutoCorrectionPanel=function(){var e=this.props,t=e.settings,r=e.setAutoCorrection;return t.isAutoCorrection?n.createElement("div",{className:"ColorPanelEnabledBox"},n.createElement("div",{className:"ColorPanelEnabledBox__header"},n.createElement(er.default,{className:""},Object(qe.getLang)("photos_pe_correction_auto_enabled")),n.createElement("span",{className:"dvd"}),n.createElement(Ot.default,{className:"ColorPanelEnabledBox__link",onClick:function(){return r(!1)}},Object(qe.getLang)("photos_pe_cancel")))):n.createElement(Ot.default,{className:"ColorPanel__link ColorPanel__link--auto",onClick:function(){return r(!0)}},Object(qe.getLang)("photos_pe_correction_auto"))},t.prototype.renderBlurPanel=function(){var e=this.props,t=e.settings,r=e.setBlurEnable,o=e.setBlurForm,a=e.setBlurSize,i=t.blur,s=[{label:Object(qe.getLang)("photos_pe_correction_blur_type_round"),value:p.default.BLUR_TYPES.ROUND},{label:Object(qe.getLang)("photos_pe_correction_blur_type_rec"),value:p.default.BLUR_TYPES.RECTANGULAR}];return i.isEnabled?n.createElement("div",{className:"ColorPanelEnabledBox"},n.createElement("div",{className:"ColorPanelEnabledBox__header"},n.createElement(er.default,{className:""},Object(qe.getLang)("photos_pe_correction_blur_enabled")),n.createElement("span",{className:"dvd"}),n.createElement(Ot.default,{className:"ColorPanelEnabledBox__link",onClick:function(){return r(!1)}},Object(qe.getLang)("photos_pe_cancel"))),n.createElement("div",{className:"ColorPanelEnabledBox__select"},n.createElement("span",{className:"ColorPanelEnabledBox__type"},Object(qe.getLang)("photos_pe_correction_blur_type")),n.createElement($t.default,{appearance:"fancy",value:i.form,options:s,onChange:function(e){return o(String(e.selected.value))}})),n.createElement(Ft.default,{min:0,max:100,gravity:2,isShowHandle:!0,isShowZero:!0,value:t.blur.size,onChange:function(e){return a(e)},formatHint:function(e){return Math.round(e)}})):n.createElement(Ot.default,{className:"ColorPanel__link ColorPanel__link--blur",onClick:function(){return r(!0)}},Object(qe.getLang)("photos_pe_correction_blur"))},t}(n.Component),nr={setColorCorrection:function(e,t){return{type:g,filter:e,value:t}},setBlurEnable:function(e){return e?Object(j.sendStat)(j.EVENTS.ENABLE_BLUR):Object(j.sendStat)(j.EVENTS.DISABLE_BLUR),{type:"SET_SETTING_BLUR_ENABLE",isEnabled:e}},setBlurForm:function(e){return{type:"SET_SETTING_BLUR_FORM",form:e}},setBlurSize:function(e){return{type:v,size:e}},setAutoCorrection:function(e){return e?Object(j.sendStat)(j.EVENTS.ENABLE_AUTOCORRECTION):Object(j.sendStat)(j.EVENTS.DISABLE_AUTOCORRECTION),{type:"SET_SETTING_AUTO_CORRECTION",isAutoCorrection:e}}},or=Object(a.connect)((function(e){return{settings:e.present.settings}}),nr)(rr),ar=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ir=function(e){function t(t){var r=e.call(this,t)||this;return r.shouldComponentUpdate=function(e){var t=r.props,n=t.currentBackgroundUrl,o=t.currentFilterName,a=n!==e.currentBackgroundUrl;return o!==e.currentFilterName||(a&&r.update(e.currentBackgroundUrl),!1)},r.handleClick=function(){r.props.setFilter(r.props.filter)},r.canvas=n.createRef(),r.renderer=new Me,r}return ar(t,e),t.prototype.componentDidMount=function(){this.update(this.props.currentBackgroundUrl)},t.prototype.render=function(){var e=Object(de.classNames)("FiltersItem",{"FiltersItem--active":this.props.currentFilterName===this.props.filter});return n.createElement("div",{className:e,onClick:this.handleClick},n.createElement("div",{className:"FiltersItem__inner",style:{width:p.default.FILTER_PREVIEW_WIDTH}},n.createElement("canvas",{className:"FiltersItem__image",ref:this.canvas,width:p.default.FILTER_PREVIEW_WIDTH*p.default.CANVAS_SCALE,height:p.default.FILTER_PREVIEW_HEIGHT*p.default.CANVAS_SCALE,style:{width:p.default.FILTER_PREVIEW_WIDTH,height:p.default.FILTER_PREVIEW_HEIGHT}}),n.createElement("span",{className:"FiltersItem__name"},Object(qe.getLang)("photos_pe_filter_"+this.props.filter))))},t.prototype.update=function(e){var t=this;e&&me.get(e).then((function(e){t.renderImage(e)})).catch((function(e){console.error(e)}))},t.prototype.renderImage=function(e){var t=this;this.renderer.render(p.default.FILTER_PREVIEW_WIDTH*p.default.CANVAS_SCALE,p.default.FILTER_PREVIEW_HEIGHT*p.default.CANVAS_SCALE,e,this.props.filter,{amount:.75,sourceSize:[e.width,e.height]}).then((function(r){if(r){var n=t.canvas.current;if(n){var o=n.getContext("2d");if(o){var a,i,s=+(e.height/e.width).toFixed(2);s>1.77?(a=n.height/s,i=n.height):(a=n.width,i=n.width*s);var c=n.width/2-a/2,l=n.height/2-i/2;ue(n,r,t.props.avgColor),o.drawImage(r,c,l,a,i)}}}})).catch((function(e){console.error(new Error(e))}))},t}(n.Component),sr={setFilter:function(e){return"regular"===e?Object(j.sendStat)(j.EVENTS.REMOVE_FILTER):Object(j.sendStat)(j.EVENTS.ADD_FILTER),{type:"SET_SETTING_FILTER",name:e}}},cr=Object(a.connect)((function(e){return{currentFilterName:e.present.settings.filter.name,currentBackgroundUrl:f(e)}}),sr)(ir),lr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ur=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return lr(t,e),t.prototype.render=function(){var e=this;return n.createElement("div",{className:"FiltersPanel"},n.createElement("div",{className:"FiltersPanel__header"},this.renderHeader()),n.createElement("div",{className:"FiltersPanel__inner"},p.default.PHOTO_FILTERS.map((function(t){return n.createElement(cr,{key:t,avgColor:e.props.avgColor,filter:t})}))))},t.prototype.renderHeader=function(){var e=this.props.settings;return"regular"===e.filter.name?n.createElement("span",null,Object(qe.getLang)("photos_pe_filter_disabled")):n.createElement("div",{className:"FiltersPanel__slider"},n.createElement("span",{className:"FiltersPanel__title"},Object(qe.getLang)("photos_pe_filter_enabled")),n.createElement(Ft.default,{min:0,max:1,value:e.filter.value,isShowHandle:!0,onChange:this.props.setFilterAmount,formatHint:function(e){return Math.round(100*e)+"%"}}))},t}(n.Component),pr={setFilterAmount:function(e){return{type:m,value:e}}},dr=Object(a.connect)((function(e){return{settings:e.present.settings,avgColor:e.present.layers.items[0].avgColor}}),pr)(ur),fr=s.ActionCreators,_r=Object(a.connect)((function(e){return{canUndo:e.past.length>0,canRedo:e.future.length>0}}),fr)((function(e){var t=e.canUndo,r=e.canRedo,n=e.undo,a=e.redo;return o.a.createElement("div",{className:"UndoRedo"},o.a.createElement("button",{className:"UndoRedo__button UndoRedo__button--undo",onClick:function(){Object(j.sendStat)(j.EVENTS.UNDO),n()},disabled:!t}),o.a.createElement("button",{className:"UndoRedo__button UndoRedo__button--redo",onClick:function(){Object(j.sendStat)(j.EVENTS.REDO),a()},disabled:!r}))})),hr=new(function(){function e(){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d")}return e.prototype.draw=function(e,t,r,n,o,a){var i=this;return new Promise((function(s,c){var l=r[0];i.canvas.width=e,i.canvas.height=t,ue(i.canvas,l.canvas,l.avgColor);var u=l.width*l.scale,p=l.height*l.scale,d=l.x-u/2,f=l.y-p/2;i.drawImage(l.canvas,u*o,p*o,d*o,f*o,l.rotate),i.drawBrush(n,o),i.drawLayers(r,o,e,t,a).then((function(){i.canvas.toBlob((function(e){s({blob:e,width:i.canvas.width,height:i.canvas.height})}),"image/jpeg",1)})).catch((function(e){c(e)}))}))},e.prototype.drawImage=function(e,t,r,n,o,a){this.context&&(this.context.save(),this.context.translate(n,o),this.context.translate(t/2,r/2),this.context.rotate(a*Math.PI/180),this.context.translate(-t/2,-r/2),this.context.drawImage(e,0,0,t,r),this.context.restore())},e.prototype.drawBrush=function(e,t){var r=this.context;r&&(r.save(),r.lineCap="round",r.lineJoin="round",e.forEach((function(e){r.lineWidth=e.width*p.default.BRUSH_WIDTH_COEFFICIENT*t,r.strokeStyle=se(e.color,e.opacity),r.beginPath(),r.moveTo(e.path[0][0]*t,e.path[0][1]*t),e.path.forEach((function(e){r.lineTo(e[0]*t,e[1]*t)})),r.stroke()})),r.restore())},e.prototype.drawLayers=function(e,t,r,n,o){var a=this;return new Promise((function(r,n){var i=[];e.forEach((function(e,t){var r=null;if(e.type!==p.default.LAYER_TYPES.BACKGROUND){if(e.type===p.default.LAYER_TYPES.STICKER){var n=o((e=e).id,p.default.STICKER_LARGE);r=a.fetchImage(n,e.width*e.scale,e.height*e.scale,e.x,e.y,e.rotate)}else if(e.type===p.default.LAYER_TYPES.IMAGE)e=e,r=a.fetchImage(e.url,e.width*e.scale,e.height*e.scale,e.x,e.y,e.rotate);else if(e.type===p.default.LAYER_TYPES.TEXT){var s=document.querySelector('[data-index="'+t+'"] .EditorLayer__inner');s&&(r=a.drawTextLayer(e,s))}r&&i.push(r)}})),Promise.all(i).then((function(e){e.forEach((function(e){var r=e.width,n=e.height,o=e.x-r/2,i=e.y-n/2;a.drawImage(e.image,r*t,n*t,o*t,i*t,e.rotate)})),r()})).catch((function(e){n(e)}))}))},e.prototype.drawTextLayer=function(e,t){return new Promise((function(r,n){var o=document.createElement("canvas"),a=o.getContext("2d");if(!a)return n();o.width=t.offsetWidth*p.default.CANVAS_SCALE+100,o.height=t.offsetHeight*p.default.CANVAS_SCALE+100;var i="";switch(e.fontStyle){case"classic":i="RobotoPE";break;case"cursive":i="PacificoPE";break;case"marker":i="AmaticPE";break;case"italics":i="TTCommonsPE";break;case"typewriter":i="GoraPE";break;case"poster":i="DinPE";break;case"retro":i="Rodchenko";break;case"impact":i="Impact";break;case"lobster":i="Lobster"}var s=e.fontSize*e.scale*p.default.FONT_SIZE_COEFFICIENT*p.default.CANVAS_SCALE;a.font=s+"px "+i+", serif",a.fillStyle=e.color,a.textAlign="center",a.textBaseline="top",function(e,t,r,n,o,a){if((a=a||0)<=0)e.fillText(t,r,n);else{for(var i=t.replace(/(\v)/gm,"\n").split("\n"),s=0,c=1;i.length>0&&c<=i.length;){var l=i.slice(0,c).join(" ");e.measureText(l).width>a?(1===c&&(c=2),e.fillText(i.slice(0,c-1).join(" "),r,n+o*s),s++,i=i.splice(c-1),c=1):c++}c>0&&e.fillText(i.join(" "),r,n+o*s)}}(a,e.text,o.width/2,50,s,o.width-100),r({image:o,width:o.width/p.default.CANVAS_SCALE,height:o.height/p.default.CANVAS_SCALE,x:e.x,y:e.y,rotate:e.rotate})}))},e.prototype.fetchImage=function(e,t,r,n,o,a){return new Promise((function(i){ae(e).then((function(e){i({image:e,width:t,height:r,x:n,y:o,rotate:a})})).catch((function(e){console.error(e)}))}))},e}()),gr=r("3oLO"),mr=r("W9Tc"),vr=r("zxIV"),Er=r("WfnU"),yr=r("3blr"),Tr=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Cr=function(){return(Cr=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},Sr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.componentDidMount=function(){window.addEventListener("keydown",t.handleKeyDown,{capture:!0}),window.addEventListener("mousedown",t.canvasMouseDown),t.getEditorData().then((function(e){var r,n,o=e.stickers,a=e.backgrounds,i=e.storyUploadUrlHash,s=e.storySaveHash,c={};o.forEach((function(e){e.items.forEach((function(e){c[e.id]=e}))})),t.props.setData({stickers:o,stickersMap:c,backgrounds:a,placeholders:Object(qe.getLang)("photos_pe_texts_placeholders").split("<br>"),fontsPlaceholders:Object(qe.getLang)("photos_pe_fonts").split("<br>"),storyUploadUrlHash:i,storySaveHash:s}),t.props.setDataLoaded(),(null===(n=null===(r=t.props.data)||void 0===r?void 0:r.serviceInfo)||void 0===n?void 0:n.open_text_editor)?t.props.addLayerText(!0,{isEdit:!0,text:""}):t.props.background.currentBackgroundType===p.default.BACKGROUND_MODES.BACKGROUND&&(t.props.addLayerText(!0,{isEdit:!0}),t.props.closeTextEditor(),t.props.setCurrentLayer(null)),t.props.stickers&&t.prepareStickers(t.props.stickers)})).catch((function(){window.showFastBox({title:Object(qe.getLang)("global_error")},Object(qe.getLang)("global_error"),Object(qe.getLang)("global_close"),(function(){window.curBox().hide(),t.props.data.close(!1,!0)}))}))},t.componentWillUnmount=function(){window.removeEventListener("keydown",t.handleKeyDown,{capture:!0}),window.removeEventListener("mousedown",t.canvasMouseDown),delete window.cur.storyPublishContext},t.getEditorData=function(){return new Promise((function(e,t){gr.ajax.post("al_photos.php",{act:"get_editor_data"},{onDone:function(t){e(t)},onFail:function(){return t(),!0}})}))},t.render=function(){var e,r=t.props,o=r.ui,a=r.data,i=r.drawings,s=r.layers,c=r.settings;if(a.artboardContainer||(e={width:a.artboardWidth,height:parseInt(a.artboardHeight)+p.default.BOTTOM_PANEL_HEIGHT}),t.isSaveDisabled=!0,a.context===p.default.CONTEXT_TYPES.STORY)t.isSaveDisabled=!1;else{var l=c.colorCorrection,u=c.filter,d=c.blur,f=c.isAutoCorrection,_=c.isCropped,h=c.flipX,g=c.flipY,m=c.rotation;t.isSaveDisabled=!(!(s.items.length<=1)||i.length||l.exposure||l.contrast||l.saturation||l.warmth||l.vignette||l.sharpness||l.grain||"regular"!==u.name||d.isEnabled||f||_||h||g||m)}return n.createElement("div",{className:"PhotoEditor",style:{height:parseInt(a.artboardHeight)+p.default.BOTTOM_PANEL_HEIGHT}},n.createElement("div",{className:"PhotoEditor__canvas",style:e},n.createElement(bt,{getStickerUrlById:t.getStickerUrlById,uploadPhoto:t.uploadPhoto,setMode:t.setMode})),n.createElement("div",{className:"PhotoEditor__tabs"},o.isDataLoaded?t.renderTabs():n.createElement(yr.default,null)),!o.isDataLoaded&&t.renderFontsPreloading())},t.renderTabs=function(){var e,r=t.props,o=r.data,a=r.background,i=o.context===p.default.CONTEXT_TYPES.STORY&&a.currentBackgroundType===p.default.BACKGROUND_MODES.BACKGROUND,s=Object(mr.partConfigEnabled)("web_new_photo_editor"),c=Object(mr.partConfigEnabled)("web_new_photo_editor_crop"),l=Object(qe.getLang)("photos_pe_save_action");return t.props.data.context===p.default.CONTEXT_TYPES.STORY&&(l=Object(qe.getLang)("photos_pe_publish_action")),n.createElement("div",{className:"PhotoEditor__inner"},n.createElement(Pt,{current:t.props.ui.currentMode,change:t.props.setMode,setMode:t.setMode},n.createElement("div",{"data-mode":p.default.TABS.STICKERS},n.createElement(Dt,{stickerMouseDown:t.addSticker})),n.createElement("div",{"data-mode":p.default.TABS.TEXT},n.createElement(Qt,null)),n.createElement("div",{"data-mode":p.default.TABS.PAINT},n.createElement(Yt,null)),c&&!(null===(e=o.addons)||void 0===e?void 0:e.disableCrop)&&o.context===p.default.CONTEXT_TYPES.PHOTO&&n.createElement("div",{"data-mode":p.default.TABS.CROP},n.createElement(Kt,null)),s&&n.createElement("div",{"data-mode":p.default.TABS.FILTERS,"data-disabled":i},n.createElement(dr,null)),s&&n.createElement("div",{"data-mode":p.default.TABS.COLOR,"data-disabled":i},n.createElement(or,null))),n.createElement("div",{className:"PhotoEditor__actions"},n.createElement(_r,null),n.createElement("div",null,n.createElement(Ze.default,{appearance:"secondary",onClick:t.props.data.close},Object(qe.getLang)("photos_pe_cancel_action")),n.createElement(Er.default,{appearance:"primary",loading:t.props.ui.isSaveLoading,disabled:t.isSaveDisabled,onClick:t.save},l))))},t.renderFontsPreloading=function(){return n.createElement("div",{className:"PhotoEditor__fontPreload"},p.default.FONTS.map((function(e){return n.createElement("span",{key:e,className:"PhotoEditorFontStyle--"+e})})))},t.save=function(){var e=t.props.data,r=e.artboardWidth,n=e.originalWidth,o=e.originalHeight,a=n/r;t.props.closeTextEditor(),t.props.setCurrentLayer(null),t.props.setSaveLoading(!0),setTimeout((function(){hr.draw(n,o,t.props.layers.items,t.props.drawings,a,t.getStickerUrlById).then((function(e){var r=e.blob,n=e.width,o=e.height,a=t.props,i=a.layers,s=a.drawings,c=a.background,l=a.settings,u=Object(j.prepareStat)(i.items,s,c.currentBackgroundType,c.currentBackgroundId),p=Object(j.prepareMediaEditorStat)(i.items,l),d=[];t.props.layers.items.forEach((function(e){e.clickableZones&&e.clickableZones.forEach((function(r){d.push(t.getPreparedClickableZone(e,r))}))}));var f={original_width:n,original_height:o,clickable_stickers:d};t.props.data.save(r,(function(){t.props.setSaveLoading(!1)}),{attachment:t.props.data.attachment,storyUploadUrlHash:t.props.data.storyUploadUrlHash,storySaveHash:t.props.data.storySaveHash,analytics:JSON.stringify(u),mediaEditorAnalytics:JSON.stringify(p),clickableStickers:JSON.stringify(f)})})).catch((function(e){t.props.setSaveLoading(!1),console.error(e)}))}),0)},t.getPreparedClickableZone=function(e,r){var n,o=t.props.data.originalWidth/t.props.data.artboardWidth,a=e.rotate*(Math.PI/180),i=e.x-e.width/2,s=e.y-e.height/2,c=parseFloat(e.x)+(i-e.x)*Math.cos(a)-(s-e.y)*Math.sin(a),l=parseFloat(e.y)+(s-e.y)*Math.cos(a)+(i-e.x)*Math.sin(a),u=null===(n=r.clickable_area)||void 0===n?void 0:n.map((function(t){var r=t.x*e.width,n=t.y*e.height,i=r*Math.cos(a)-n*Math.sin(a),s=r*Math.sin(a)+n*Math.cos(a);return{x:(c+i)*o,y:(l+s)*o}})),p={type:r.action_type,clickable_area:u};return"link"===r.action_type?(p.link=r.action.link,r.action.tooltip_text_key&&(p.tooltip_text_key=r.action.tooltip_text_key)):"app"===r.action_type&&(p.app_id=r.action.app_id,r.action.app_context&&(p.app_id=r.action.app_id)),p},t.handleKeyDown=function(e){if("Escape"==e.key&&t.props.layers.currentIndex&&t.props.layers.items[t.props.layers.currentIndex].isEdit&&(e.preventDefault(),e.stopPropagation(),t.props.closeTextEditor()),(e.ctrlKey||e.metaKey)&&"z"===e.key&&(e.shiftKey?t.props.redo():t.props.undo()),null!==t.props.layers.currentIndex&&"TEXTAREA"!==e.target.nodeName)if(["Backspace","Delete"].includes(e.key))e.preventDefault(),t.props.layers.items[t.props.layers.currentIndex].canDelete&&t.props.deleteLayer();else if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)){var r=t.getCurrentLayer();if(!r)return;var n={x:r.x,y:r.y},o=e.shiftKey?10:1;switch(e.key){case"ArrowUp":n.y-=o;break;case"ArrowDown":n.y+=o;break;case"ArrowLeft":n.x-=o;break;case"ArrowRight":n.x+=o}t.props.setLayerPosition(n.x,n.y)}},t.canvasMouseDown=function(e){var r=t.getCurrentLayer(),n=e.target;if("TEXTAREA"!==n.tagName)return!!n.closest(".EditorCanvas")&&(!n.closest(".SwitchMode")&&void([p.default.TABS.PAINT,p.default.TABS.FILTERS].includes(t.props.ui.currentMode)||(r&&r.type===p.default.LAYER_TYPES.TEXT&&r.isEdit?t.props.closeTextEditor():(t.props.ui.currentMode===p.default.TABS.COLOR&&t.props.settings.blur.isEnabled&&t.moveBlurStart(e),n.closest(".EditorLayer")?t.layerDragStart(e):r&&t.props.setCurrentLayer(null)))))},t.moveBlurStart=function(e){window.addEventListener("mousemove",t.moveBlurProcess),window.addEventListener("mouseup",t.moveBlurFinish),t.moveBlurProcess(e)},t.moveBlurProcess=function(e){var r=ie(e,document.querySelector(".EditorCanvas__canvas--bg")),n=r.x,o=r.y,a=r.width,i=r.height,s=[Math.max(0,Math.min(n/a,1)),1-Math.max(0,Math.min(o/i,1))];t.props.setBlurPosition(s)},t.moveBlurFinish=function(){window.removeEventListener("mousemove",t.moveBlurProcess),window.removeEventListener("mouseup",t.moveBlurFinish)},t.getCurrentLayer=function(){var e=t.props.layers,r=e.items,n=e.currentIndex;return null===n?n:r[n]},t.layerDragStart=function(e){window.addEventListener("mousemove",t.layerDragProcess),window.addEventListener("mouseup",t.layerDragFinish);var r,n=e.target.closest("[data-index]");r=n?+Object(vr.domData)(n,"index"):t.props.layers.currentIndex,t.props.layers.currentIndex!==r&&t.props.setCurrentLayer(r);var o=ie(e,document.querySelector(".EditorCanvas__canvas--draw")),a=o.x,i=o.y;if(t.currentLayer=t.getCurrentLayer(),t.currentLayer){var s=t.currentLayer;s.isBackground&&s.locked?t.props.setCurrentLayer(null):(t.clientX=e.clientX,t.clientY=e.clientY,t.shiftX=a-t.currentLayer.x,t.shiftY=i-t.currentLayer.y)}},t.layerDragProcess=function(e){if(t.currentLayer){var r=document.querySelector(".EditorCanvas__canvas--draw");if(r){var n=ie(e,r),o=n.x,a=n.y;if(void 0!==t.shiftX&&void 0!==t.shiftY){var i=o-t.shiftX,s=a-t.shiftY;t.props.setLayerPosition(i,s),t.props.ui.isShowDropBox||t.props.setShowDropBox(!0)}}}},t.layerDragFinish=function(e){if(window.removeEventListener("mousemove",t.layerDragProcess),window.removeEventListener("mouseup",t.layerDragFinish),t.getCurrentLayer()&&t.currentLayer&&void 0!==t.shiftX&&void 0!==t.shiftY){var r=document.querySelector(".EditorCanvas__canvas--draw");if(r){var n=ie(e,r),o=n.x,a=n.y,i=o-t.shiftX,s=a-t.shiftY;t.props.setLayerPosition(Math.round(i),Math.round(s)),t.props.setShowDropBox(!1),delete t.currentLayer,delete t.shiftX,delete t.shiftY,delete t.clientX,delete t.clientY}}},t.getStickerUrlById=function(e,r){var n=t.props.data.stickersMap[e];return n?n.sizes[r]:""},t.addSticker=function(e,r){e.persist();var n=document.querySelector(".EditorCanvas__canvas--draw");if(n){var o=ie(e.nativeEvent,n),a=o.width,i=o.height;t.props.addLayerSticker({id:r,x:a/2,y:i/2,width:p.default.LAYER_DEFAULT_SIZE,height:p.default.LAYER_DEFAULT_SIZE,rotate:0,canDelete:!0,scale:1})}},t.prepareStickers=function(e){var r=t.props.data,n=r.artboardWidth,o=r.artboardHeight;e.forEach((function(e){var r=e.sticker.transform||{},a=r.gravity,i=void 0===a?"center":a,s=r.rotation,c=void 0===s?0:s,l=r.translation_x,u=void 0===l?0:l,d=r.translation_y,f=void 0===d?0:d,_=r.relation_width;if(u=Math.min(Math.max(u,-1),1),f=Math.min(Math.max(f,-1),1),_&&(_=Math.min(Math.max(_,.1),1)),"renderable"===e.sticker_type)t.prepareRenderableSticker(e.sticker,i,u,f,_).then((function(e){var r=e.url,n=e.x,o=e.y,a=e.stickerWidth,i=e.stickerHeight,s=e.clickableZones;t.props.addLayerImage({url:r,x:n,y:o,width:Math.round(a),height:Math.round(i),rotate:-c,clickableZones:s,canDelete:!0,scale:1})})).catch((function(e){console.error(e)}));else if("native"===e.sticker_type)switch(e.sticker.action_type){case"sticker":var h=_?n*_:p.default.LAYER_DEFAULT_SIZE,g=_?n*_:p.default.LAYER_DEFAULT_SIZE,m=e.sticker.action.pack_id+"_"+e.sticker.action.sticker_id;if(t.props.data.stickersMap[m]){var v=le(i,n,o,h/2,g/2,u*n,f*o),E=v.x,y=v.y;t.props.addLayerSticker({id:m,x:E,y,width:h,height:g,rotate:-c,canDelete:!0,scale:1})}break;case"text":var T=.5;_&&(T=t.getFontSize(e.sticker.action.text,n*_,e.sticker.action.style));var C=t.getTextRect(e.sticker.action.text,T*p.default.FONT_SIZE_COEFFICIENT,e.sticker.action.style),S=(h=C.width,g=C.height,le(i,n,o,h/2,g/2,u*n,f*o));E=S.x,y=S.y;t.props.addLayerText(!1,{text:e.sticker.action.text,style:e.sticker.action.style,color:e.sticker.action.selection_color,fontSize:T,initialFontSize:T,rotate:-c,scale:1,x:E,y})}}))},t.prepareRenderableSticker=function(e,r,n,o,a){var i=t.props.data,s=i.artboardWidth,c=i.artboardHeight,l=i.originalWidth/s;return new Promise((function(t,i){"string"!=typeof e.url&&"string"!=typeof e.blob&&i();var u=e.url||e.blob||"";ae(u).then((function(i){var p=i.height/i.width,d=0,f=0;a?f=(d=s*a)*p:(d=i.width/l,f=i.height/l,d>s&&(f=(d=s)*p));var _,h=le(r,s,c,d/2,f/2,n*s,o*c),g=h.x,m=h.y;e.clickable_zones&&(_=e.clickable_zones.map((function(e){var t;return t=e.clickable_area?e.clickable_area.map((function(e){return{x:e.x/i.width,y:e.y/i.height}})):[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}],Cr(Cr({},e),{clickable_area:t})}))),t({url:u,x:g,y:m,stickerWidth:d,stickerHeight:f,clickableZones:_})})).catch((function(){i()}))}))},t.getTextRect=function(e,t,r){var n=document.createElement("span");n.innerHTML=e,n.style.display="inline-block",n.style.fontSize=t+"px",n.style.lineHeight="1em",n.style.whiteSpace="pre",r&&n.classList.add("PhotoEditorFontStyle--"+r),document.body.append(n);var o=n.getBoundingClientRect();return n.remove(),o},t.getFontSize=function(e,t,r){var n=2*t,o=document.createElement("span");for(o.innerHTML=e,o.style.display="inline-block",o.style.width=t+"px",o.style.fontSize=n+"px",o.style.lineHeight="1em",o.style.whiteSpace="pre",r&&o.classList.add("PhotoEditorFontStyle--"+r),document.body.append(o);n&&o.scrollWidth>Math.round(t);)n--,o.style.fontSize=n+"px";return o.remove(),n/100},t.uploadPhoto=function(e){ce().then((function(r){e&&e(),t.props.setCurrentPhotoUrl(r)})).catch((function(){window.showFastBox({title:Object(qe.getLang)("global_error")},Object(qe.getLang)("stories_create_image_incorrect"))}))},t.setMode=function(e){var r=t.props.ui,n=t.props.background,o=n.currentBackgroundType,a=n.currentPhotoUrl;t.props.setCurrentLayer(null),e===p.default.BACKGROUND_MODES.PHOTO&&!a||o===p.default.BACKGROUND_MODES.PHOTO&&o===e?t.uploadPhoto((function(){t.props.setBackgroundType(e)})):(t.props.setBackgroundType(e),e===p.default.BACKGROUND_MODES.BACKGROUND&&[p.default.TABS.COLOR,p.default.TABS.FILTERS].includes(r.currentMode)&&t.props.setMode(p.default.TABS.STICKERS))},t}return Tr(t,e),t}(n.Component),br=Object.assign(s.ActionCreators,{setMode:J,addLayerSticker:function(e){return Object(j.sendStat)(j.EVENTS.ADD_STICKER),W("ADD_LAYER_STICKER",{type:p.default.LAYER_TYPES.STICKER,id:e.id,x:e.x,y:e.y,width:e.width,height:e.height,rotate:e.rotate,canDelete:e.canDelete,scale:e.scale})},addLayerText:z,addLayerImage:function(e){return W("ADD_LAYER_IMAGE",{type:p.default.LAYER_TYPES.IMAGE,url:e.url,x:e.x,y:e.y,width:e.width,height:e.height,rotate:e.rotate,clickableZones:e.clickableZones,canDelete:e.canDelete,scale:e.scale})},setLayerPosition:function(e,t){return function(r,n){var o=n().present.layers,a=o.currentIndex,i=o.items;null!==a&&i[a]&&r({type:"SET_LAYER_POSITION",payload:{x:e,y:t}})}},deleteLayer:V,setCurrentLayer:G,setDataLoaded:function(){return{type:"SET_DATA_LOADED"}},setShowDropBox:q,setSaveLoading:function(e){return{type:"SET_SAVE_LOADING",value:e}},closeTextEditor:Z,setData:re,setBlurPosition:function(e){return{type:E,position:e}},setCurrentPhotoUrl:te,setBackgroundType:ee}),wr=Object(a.connect)((function(e){return{ui:e.present.ui,settings:e.present.settings,layers:e.present.layers,drawings:e.present.drawings,background:e.present.background,data:e.present.data}}),br)(Sr),Or=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),xr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getBackgroundType=function(){var e=p.default.CONTEXT_TYPES,r=p.default.BACKGROUND_MODES;return t.props.context===e.STORY?t.props.photoUrl?r.PHOTO:r.BACKGROUND:r.PHOTO},t}return Or(t,e),t.prototype.render=function(){var e,t,r;return window.cur.photoEditorStore=(e={data:this.props,background:{currentBackgroundType:this.getBackgroundType(),currentPhotoUrl:this.props.photoUrl,currentBackgroundId:1}},t=Object(s.newHistory)([],e,[]),r=l.composeWithDevTools(Object(i.applyMiddleware)(u.default)),Object(i.createStore)(U,t,r)),n.createElement(a.Provider,{store:window.cur.photoEditorStore},n.createElement(wr,{stickers:this.props.stickers}))},t.defaultProps={originalWidth:p.default.STORY_BASE_WIDTH,originalHeight:p.default.STORY_BASE_HEIGHT},t}(n.Component);t.default=xr},"1VNw":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionCreators=t.ActionTypes=void 0;var n={UNDO:"@@redux-undo/UNDO",REDO:"@@redux-undo/REDO",JUMP_TO_FUTURE:"@@redux-undo/JUMP_TO_FUTURE",JUMP_TO_PAST:"@@redux-undo/JUMP_TO_PAST",JUMP:"@@redux-undo/JUMP",CLEAR_HISTORY:"@@redux-undo/CLEAR_HISTORY"};t.ActionTypes=n;var o={undo:function(){return{type:n.UNDO}},redo:function(){return{type:n.REDO}},jumpToFuture:function(e){return{type:n.JUMP_TO_FUTURE,index:e}},jumpToPast:function(e){return{type:n.JUMP_TO_PAST,index:e}},jump:function(e){return{type:n.JUMP,index:e}},clearHistory:function(){return{type:n.CLEAR_HISTORY}}};t.ActionCreators=o},"1y80":function(e,t,r){"use strict";function n(e,t,r,n,o){return window.statlogsValueEvent(e,t,r,n,o)}function o(e){return Math.random()<e}function a(e,t,r,a,i,s){o(e)&&n(t,r,a,i,s)}r.r(t),r.d(t,"statlogsValueEvent",(function(){return n})),r.d(t,"randEnabled",(function(){return o})),r.d(t,"statlogsProbValueEvent",(function(){return a}))},"9O7i":function(e,t,r){"use strict";function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Array.isArray(e)?e:"string"==typeof e?[e]:t}Object.defineProperty(t,"__esModule",{value:!0}),t.parseActions=n,t.isHistory=function(e){return void 0!==e.present&&void 0!==e.future&&void 0!==e.past&&Array.isArray(e.future)&&Array.isArray(e.past)},t.includeAction=function(e){var t=n(e);return function(e){return t.indexOf(e.type)>=0}},t.excludeAction=function(e){var t=n(e);return function(e){return t.indexOf(e.type)<0}},t.combineFilters=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.reduce((function(e,t){return function(r,n,o){return e(r,n,o)&&t(r,n,o)}}),(function(){return!0}))},t.groupByActionTypes=function(e){var t=n(e);return function(e){return t.indexOf(e.type)>=0?e.type:null}},t.newHistory=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return{past:e,present:t,future:r,group:n,_latestUnfiltered:t,index:e.length,limit:e.length+r.length+1}}},FEd1:function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o.set(t.debug);var r,n=l({limit:void 0,filter:function(){return!0},groupBy:function(){return null},undoType:a.ActionTypes.UNDO,redoType:a.ActionTypes.REDO,jumpToPastType:a.ActionTypes.JUMP_TO_PAST,jumpToFutureType:a.ActionTypes.JUMP_TO_FUTURE,jumpType:a.ActionTypes.JUMP,neverSkipReducer:!1,ignoreInitialState:!1,syncFilter:!1},t,{initTypes:(0,i.parseActions)(t.initTypes,["@@redux-undo/INIT"]),clearHistoryType:(0,i.parseActions)(t.clearHistoryType,[a.ActionTypes.CLEAR_HISTORY])}),s=n.neverSkipReducer?function(t,r){for(var n=arguments.length,o=new Array(n>2?n-2:0),a=2;a<n;a++)o[a-2]=arguments[a];return l({},t,{present:e.apply(void 0,[t.present,r].concat(o))})}:function(e){return e};return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o.start(a,t);for(var c,l=t,u=arguments.length,p=new Array(u>2?u-2:0),v=2;v<u;v++)p[v-2]=arguments[v];if(!r){if(o.log("history is uninitialized"),void 0===t){var E={type:"@@redux-undo/CREATE_HISTORY"},y=e.apply(void 0,[t,E].concat(p));return l=d(y,n.ignoreInitialState),o.log("do not set initialState on probe actions"),o.end(l),l}(0,i.isHistory)(t)?(l=r=n.ignoreInitialState?t:(0,i.newHistory)(t.past,t.present,t.future),o.log("initialHistory initialized: initialState is a history",r)):(l=r=d(t,n.ignoreInitialState),o.log("initialHistory initialized: initialState is not a history",r))}switch(a.type){case void 0:return l;case n.undoType:return c=g(l,-1),o.log("perform undo"),o.end(c),s.apply(void 0,[c,a].concat(p));case n.redoType:return c=g(l,1),o.log("perform redo"),o.end(c),s.apply(void 0,[c,a].concat(p));case n.jumpToPastType:return c=h(l,a.index),o.log("perform jumpToPast to ".concat(a.index)),o.end(c),s.apply(void 0,[c,a].concat(p));case n.jumpToFutureType:return c=_(l,a.index),o.log("perform jumpToFuture to ".concat(a.index)),o.end(c),s.apply(void 0,[c,a].concat(p));case n.jumpType:return c=g(l,a.index),o.log("perform jump to ".concat(a.index)),o.end(c),s.apply(void 0,[c,a].concat(p));case m(a.type,n.clearHistoryType):return c=d(l.present,n.ignoreInitialState),o.log("perform clearHistory"),o.end(c),s.apply(void 0,[c,a].concat(p));default:if(c=e.apply(void 0,[l.present,a].concat(p)),n.initTypes.some((function(e){return e===a.type})))return o.log("reset history due to init action"),o.end(r),r;if(l._latestUnfiltered===c)return l;var T="function"==typeof n.filter&&!n.filter(a,c,l);if(T){var C=(0,i.newHistory)(l.past,c,l.future,l.group);return n.syncFilter||(C._latestUnfiltered=l._latestUnfiltered),o.log("filter ignored action, not storing it in past"),o.end(C),C}var S=n.groupBy(a,c,l);if(null!=S&&S===l.group){var b=(0,i.newHistory)(l.past,c,l.future,l.group);return o.log("groupBy grouped the action with the previous action"),o.end(b),b}return l=f(l,c,n.limit,S),o.log("inserted new state into history"),o.end(l),l}}};var o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==n(e)&&"function"!=typeof e)return{default:e};var t=s();if(t&&t.has(e))return t.get(e);var r={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var i=o?Object.getOwnPropertyDescriptor(e,a):null;i&&(i.get||i.set)?Object.defineProperty(r,a,i):r[a]=e[a]}r.default=e,t&&t.set(e,r);return r}(r("Hh3O")),a=r("1VNw"),i=r("9O7i");function s(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return s=function(){return e},e}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){u(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function d(e,t){var r=(0,i.newHistory)([],e,[]);return t&&(r._latestUnfiltered=null),r}function f(e,t,r,n){var a=e.past.length+1;o.log("inserting",t),o.log("new free: ",r-a);var s=e.past,c=e._latestUnfiltered,l=r&&r<=a,u=s.slice(l?1:0),d=null!=c?[].concat(p(u),[c]):u;return(0,i.newHistory)(d,t,[],n)}function _(e,t){if(t<0||t>=e.future.length)return e;var r=e.past,n=e.future,o=e._latestUnfiltered,a=[].concat(p(r),[o],p(n.slice(0,t))),s=n[t],c=n.slice(t+1);return(0,i.newHistory)(a,s,c)}function h(e,t){if(t<0||t>=e.past.length)return e;var r=e.past,n=e.future,o=e._latestUnfiltered,a=r.slice(0,t),s=[].concat(p(r.slice(t+1)),[o],p(n)),c=r[t];return(0,i.newHistory)(a,c,s)}function g(e,t){return t>0?_(e,t-1):t<0?h(e,e.past.length+t):e}function m(e,t){return t.indexOf(e)>-1?e:!e}},Hh3O:function(e,t,r){"use strict";function n(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var o,a;Object.defineProperty(t,"__esModule",{value:!0}),t.set=function(e){o=e},t.start=function(e,t){void(a={header:[],prev:[],action:[],next:[],msgs:[]}),o&&(console.group?(a.header=["%credux-undo","font-style: italic","action",e.type],a.action=l("action",s,e),a.prev=l("prev history",i,t)):(a.header=["redux-undo action",e.type],a.action=["action",e],a.prev=["prev history",t]))},t.end=function(e){o&&(console.group?a.next=l("next history",c,e):a.next=["next history",e],function(){var e=a,t=e.header,r=e.prev,o=e.next,i=e.action,s=e.msgs;if(console.group){var c,l,u,p,d;(c=console).groupCollapsed.apply(c,n(t)),(l=console).log.apply(l,n(r)),(u=console).log.apply(u,n(i)),(p=console).log.apply(p,n(o)),(d=console).log.apply(d,n(s)),console.groupEnd()}else{var f,_,h,g,m;(f=console).log.apply(f,n(t)),(_=console).log.apply(_,n(r)),(h=console).log.apply(h,n(i)),(g=console).log.apply(g,n(o)),(m=console).log.apply(m,n(s))}}())},t.log=function(){if(o){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];a.msgs=a.msgs.concat([].concat(t,["\n"]))}};var i="#9E9E9E",s="#03A9F4",c="#4CAF50";function l(e,t,r){return["%c".concat(e),"color: ".concat(t,"; font-weight: bold"),r]}},dImZ:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ActionTypes",{enumerable:!0,get:function(){return o.ActionTypes}}),Object.defineProperty(t,"ActionCreators",{enumerable:!0,get:function(){return o.ActionCreators}}),Object.defineProperty(t,"parseActions",{enumerable:!0,get:function(){return a.parseActions}}),Object.defineProperty(t,"isHistory",{enumerable:!0,get:function(){return a.isHistory}}),Object.defineProperty(t,"includeAction",{enumerable:!0,get:function(){return a.includeAction}}),Object.defineProperty(t,"excludeAction",{enumerable:!0,get:function(){return a.excludeAction}}),Object.defineProperty(t,"combineFilters",{enumerable:!0,get:function(){return a.combineFilters}}),Object.defineProperty(t,"groupByActionTypes",{enumerable:!0,get:function(){return a.groupByActionTypes}}),Object.defineProperty(t,"newHistory",{enumerable:!0,get:function(){return a.newHistory}}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.default}});var n,o=r("1VNw"),a=r("9O7i"),i=(n=r("FEd1"))&&n.__esModule?n:{default:n}},sINF:function(e,t,r){"use strict";function n(e){return function(t){var r=t.dispatch,n=t.getState;return function(t){return function(o){return"function"==typeof o?o(r,n,e):t(o)}}}}r.r(t);var o=n();o.withExtraArgument=n,t.default=o},ufMw:function(e,t,r){"use strict";r.r(t),r.d(t,"EVENTS",(function(){return s})),r.d(t,"sendStat",(function(){return l})),r.d(t,"prepareStat",(function(){return u})),r.d(t,"prepareMediaEditorStat",(function(){return p}));var n=r("1y80"),o=r("98sY"),a=r("xYVc"),i=r("W9Tc"),s={FLIP_X:"flipX",FLIP_Y:"flipY",ADD_FILTER:"add_filter",REMOVE_FILTER:"remove_filter",UNDO:"undo",REDO:"redo",ENABLE_AUTOCORRECTION:"enable_autocorrection",DISABLE_AUTOCORRECTION:"disable_autocorrection",ENABLE_BLUR:"enable_blur",DISABLE_BLUR:"disable_blur",ZOOM:"zoom",UNZOOM:"unzoom",TURN_LEFT:"turn_left",TURN_RIGHT:"turn_right",ADD_STORY:"add_story",ADD_STORY_FROM_SHARING:"add_story_from_sharing",CLICK_TO_CAMERA_ICON:"click_to_camera_icon",CLICK_TO_GRADIENT_ICON:"click_to_gradient_icon",ADD_TEXT:"add_text",EDIT_TEXT:"edit_text",DELETE_TEXT:"delete_text",ADD_STICKER:"add_sticker",DELETE_STICKER:"delete_sticker",ADD_GRAFFITI:"add_graffiti",SELECT_BACKGROUND:"select_background"},c=[s.ADD_STORY,s.ADD_STORY_FROM_SHARING,s.CLICK_TO_CAMERA_ICON,s.CLICK_TO_GRADIENT_ICON,s.ADD_TEXT,s.EDIT_TEXT,s.DELETE_TEXT,s.ADD_STICKER,s.DELETE_STICKER,s.ADD_GRAFFITI,s.SELECT_BACKGROUND];function l(e){var t=0,r=0;if(window.cur.pvCurPhoto){var a=window.cur.pvCurPhoto.id.split("_"),s=a[0],l=a[1];t=parseInt(s),r=parseInt(l)}var u={event_type:e,media_type:window.cur.storyPublishContext?"story":"photo",media_owner_id:t,media_id:r};Object(i.partConfigEnabled)("story_publish_analytics_log")&&Object(o.debugLog)(u),Object(n.statlogsValueEvent)("media_editor_product_analytics",u),c.includes(e)&&Object(n.statlogsValueEvent)("story_create_product_analytics",{event_type:e,story_type:"photo"})}function u(e,t,r,n){var o=0,i="photo";r===a.default.BACKGROUND_MODES.BACKGROUND&&(i=(o=n)>100?"emojies":"gradients");var s={has_text:0,has_sticker:0,has_graffiti:0,background_type:i,background_id:o},c=[],l=[],u=[];return e.forEach((function(e){if(e.type===a.default.LAYER_TYPES.STICKER){var t=(i=e).id.split("_"),r=t[0],n=t[1],o=parseInt(r);c.push({id:parseInt(n),pack_id:o||0,type:o?"from_pack":"individual"})}else if(e.type===a.default.LAYER_TYPES.TEXT){var i=e;l.push({text:i.text,font:i.fontStyle,size:Math.round(i.fontSize*a.default.FONT_SIZE_COEFFICIENT),color:i.color.slice(1),background:"none",align:"center"})}})),l.length&&(s.has_text=1,s.texts=l),c.length&&(s.has_sticker=1,s.stickers=c),t.forEach((function(e){u.push({brush:e.opacity,size:e.width,color:e.color.slice(1)})})),u.length&&(s.has_graffiti=1,s.graffities=u),s}function p(e,t){var r=0,n=0;if(window.cur.pvCurPhoto){var o=window.cur.pvCurPhoto.id.split("_"),i=o[0],s=o[1];r=parseInt(i),n=parseInt(s)}var c={media_type:window.cur.storyPublishContext?"story":"photo",media_owner_id:r,media_id:n,is_cropped:t.isCropped,is_autocorrected:t.isAutoCorrection,rotation:t.rotation,filter:t.filter.name,filter_value:100*t.filter.value,ratio:t.cropAspect,photo_correction:[{type:"exposure",value:100*t.colorCorrection.exposure},{type:"contrast",value:100*t.colorCorrection.contrast},{type:"saturation",value:100*t.colorCorrection.saturation},{type:"warmth",value:100*t.colorCorrection.warmth},{type:"vignette",value:100*t.colorCorrection.vignette},{type:"sharpness",value:100*t.colorCorrection.sharpness},{type:"grain",value:100*t.colorCorrection.grain}]};t.blur.isEnabled&&(c.blur_type=t.blur.form,c.blur_value=t.blur.size);var l=[];return e.forEach((function(e){if(e.type===a.default.LAYER_TYPES.TEXT){var t=e;l.push({text:t.text,font:t.fontStyle,size:Math.round(t.fontSize*a.default.FONT_SIZE_COEFFICIENT),color:t.color.slice(1),background:"none",align:"center"})}})),l.length&&(c.has_text=1,c.texts=l),c}},xYVc:function(e,t,r){"use strict";r.r(t);var n=r("t7n3"),o=[{title:"photos_pe_crop_aspect_free",value:0},{title:"photos_pe_crop_aspect_original",value:-1},{title:"photos_pe_crop_aspect_16_9",value:16/9},{title:"photos_pe_crop_aspect_4_3",value:4/3},{title:"photos_pe_crop_aspect_1_1",value:1},{title:"photos_pe_crop_aspect_3_4",value:3/4},{title:"photos_pe_crop_aspect_9_16",value:9/16}];t.default={TABS:{STICKERS:"stickers",TEXT:"text",PAINT:"paint",CROP:"crop",FILTERS:"filters",COLOR:"color"},BACKGROUND_MODES:{PHOTO:"photo",BACKGROUND:"background"},STORY_BASE_WIDTH:1080,STORY_BASE_HEIGHT:1920,BOTTOM_PANEL_HEIGHT:50,CANVAS_SCALE:Object(n.isRetina)()?2:1,STICKER_THUMB:"thumb",STICKER_SMALL:64,STICKER_MEDIUM:Object(n.isRetina)()?256:128,STICKER_LARGE:512,COLORS:["#FFFFFF","#000000","#FF3301","#FF8C49","#F9D827","#2EBA48","#4189E8","#9F4BED","#69E4B3","#FF84A0","#F7A978","#F8786C","#8B3232","#93B658","#556E35","#5B4490","#1B1B1B","#333333","#4D4D4D","#666666","#808080","#999999","#B3B3B3","#CCCCCC"],FONTS:["classic","cursive","marker","italics","typewriter","poster","retro","impact","lobster"],BRUSH_WIDTH_COEFFICIENT:40,FONT_SIZE_COEFFICIENT:100,PHOTO_FILTERS:["regular","nox","vesper","latona","liber","luna","minerva","mitra","pro","terra","veles","vesta","zaria","sepia","genius","horus","fortuna"],COLOR_CORRECTION:["exposure","contrast","saturation","warmth","vignette","sharpness","grain"],BLUR_TYPES:{ROUND:"round",RECTANGULAR:"rectangular"},AVERAGE_COLORS_MAP:[{s:12,v:-40},{s:9,v:-30},{s:6,v:-20},{s:3,v:-10},{s:0,v:0},{s:-3,v:10},{s:-6,v:20},{s:-9,v:30},{s:-12,v:40}],LAYER_TYPES:{STICKER:"sticker",TEXT:"text",IMAGE:"image",BACKGROUND:"background"},LAYER_MIN_SIZE:30,LAYER_DEFAULT_SIZE:128,CONTEXT_TYPES:{PHOTO:"photo",STORY:"story"},FILTER_PREVIEW_WIDTH:127,FILTER_PREVIEW_HEIGHT:95,DRAWING_PREVIEW_WIDTH:270,DRAWING_PREVIEW_HEIGHT:110,CROP_MIN_SIZE:100,CROP_SIDES:{CENTER:"center",NW:"nw",NE:"ne",SW:"sw",SE:"se",N:"n",S:"s",W:"w",E:"e"},CROP_ASPECTS:o,CROP_ASPECT_FREE:0,CROP_ASPECT_ORIGINAL:-1}}}]);try{stManager.done("cmodules/bundles/9b69690c2f17eb6642dea9531af86fbd.13725beb669e4bd60350.js")}catch(e){}